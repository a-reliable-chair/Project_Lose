[
    {
        "name": "Intro",
        "trigger": "level_start",
        "level_nid": "1",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "level_var;RoutEnemies;1",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    give_skill;Lamonte;Lifeline;no_banner",
            "    change_team;Lamonte;player",
            "    change_team;Garvey;player",
            "    add_weather;night",
            "    set_fog_of_war;gba;3",
            "    enable_fog_of_war;1",
            "    add_region;House1;3, 15;1,1;event;<yellow>Visit</yellow>;only_once",
            "    add_region;House2;17, 14;1,1;event;<yellow>Visit</yellow>;only_once",
            "    add_region;VisionTopLeft;14, 2;1, 1;vision;2",
            "    add_region;VisionTopRight;18, 2;1, 1;vision;2",
            "    add_region;VisionBotLeft;3, 15;1, 1;vision;2",
            "    add_region;VisionBotMid;11, 12;1, 1;vision;3",
            "    add_region;VisionBotRight;17, 14;1, 1;vision;2",
            "    add_region;Form1;4, 0;1,1;formation",
            "    add_region;Form2;6, 0;1,1;formation",
            "    add_region;Form3;5, 1;1,1;formation",
            "    add_region;Form4;7, 1;1,1;formation",
            "    add_region;Form5;4, 2;1,1;formation",
            "    add_region;Form6;6, 2;1,1;formation",
            "    remove_region;Alleyway1_1",
            "    remove_region;Alleyway1_2",
            "    remove_region;Alleyway1_3",
            "    remove_region;Alleyway1_4",
            "    remove_region;Alleyway1_5",
            "    remove_region;Alleyway1_6",
            "    remove_region;Alleyway1_7",
            "    add_group;Enemy1;Enemy1Placement;immediate",
            "    add_group;Stationary;Stationary;immediate",
            "    add_unit;Laisren;4,0;immediate",
            "    add_unit;Corridon;6,0;immediate",
            "    add_unit;Elspeth;5,1;immediate",
            "    add_unit;Orla;7,1;immediate",
            "    add_unit;Ailsa;4,2;immediate",
            "    add_unit;Lamonte;6,2;immediate",
            "    show_layer;Boxes",
            "    if;game.mode.nid == 'Lunatic'",
            "        remove_region;VisionTopLeft",
            "        remove_region;VisionTopRight",
            "        remove_region;VisionBotLeft",
            "        remove_region;VisionBotMid",
            "        remove_region;VisionBotRight",
            "    end",
            "    hide_layer;Boxes",
            "    add_unit;Barrel_1;10, 13;immediate",
            "    add_unit;Barrel_3;11, 14;immediate",
            "    add_unit;Barrel_5;12, 13;immediate",
            "    add_unit;Leod;11, 13;immediate",
            "else",
            "    trigger_script;Global DeadUnitsRevive",
            "    give_skill;Leod;NPCVision;no_banner",
            "    give_skill;Garvey;NPCVision;no_banner",
            "    give_skill;Lamonte;NPCVision;no_banner",
            "    # Market / Pier",
            "    change_tilemap;Ch4",
            "    add_weather;sunset",
            "    move_cursor;21, 3;immediate",
            "    add_unit;DeadVillager_1;12, 3;immediate",
            "    add_unit;DeadVillager_2;14, 5;immediate",
            "    add_unit;DeadVillager_3;15, 4;immediate",
            "    add_unit;Cutscene_1;14, 4;immediate",
            "    add_unit;Cutscene_2;13, 5;immediate",
            "    music;Hulking Step of the Empire",
            "    transition;open;500",
            "    add_unit;Leod;21, 3;immediate;push",
            "    add_unit;Lamonte;21, 4;immediate;push",
            "    add_unit;Garvey;21, 3;immediate;push",
            "    move_unit;Leod;18, 3;normal;no_block",
            "    move_unit;Lamonte;18, 4;normal;no_block",
            "    move_unit;Garvey;19, 3;normal;push",
            "    multi_add_portrait;Leod;Left;Lamonte;MidRight;Garvey;FarRight",
            "    # Leod, Lamonte and Garvey are walking around at the beginning of the invasion and stumble upon dead villagers",
            "    s;Leod;My word...{w} That such horrors would be inflicted upon our fair town...",
            "    s;Garvey;Didn't know you cared so much, Leod.",
            "    s;Leod;Hmph.{w} Even in times such as these, you cannot keep your barbs to yourself.{w} Despicable.",
            "    s;Lamonte;Hey now, could the both of you just knock it off?{w} We can't be at each other's throats like this!",
            "    s;Leod;Peh.{w} Yes, yes, you're right.{w} I am simply...{w} overcome.{w} This barbarism...{w} it makes my blood boil.",
            "    s;Lamonte;You and me both, boss...",
            "    s;Garvey;... Quiet, both of you.{w} I hear something.",
            "    multi_remove_portrait;Leod;Lamonte;Garvey",
            "    move_unit;Cutscene_1;17, 4;normal;push;60;no_block;no_follow",
            "    move_unit;Cutscene_2;16, 3;normal;push;60;no_follow",
            "    wait;250",
            "    add_portrait;SoldierPurple;Left",
            "    # Soldiers show up and say soldier things, attacks and gets rekt by Garvey",
            "    speak;SoldierPurple;Hah!{w} We have you now!{w} For the empire!",
            "    remove_portrait;SoldierPurple",
            "    interact_unit;Cutscene_1;Lamonte;miss1,end;Junk9;force_no_animation",
            "    move_unit;Leod;18, 4;normal;stack;no_block",
            "    move_unit;Garvey;18, 3;normal;stack",
            "    add_portrait;Garvey;Right",
            "    speak;Garvey;Son of a-{w} Both of you, get down!",
            "    remove_portrait;Garvey",
            "    move_unit;Leod;19, 3;normal;stack",
            "    interact_unit;Garvey;Cutscene_1;crit1;Junk8;force_no_animation",
            "    kill_unit;Cutscene_1",
            "    wait;250",
            "    add_portrait;Leod;Left",
            "    # Leod runs off like the coward he is",
            "    speak;Leod;Ahh!{w} N-n-no!{w} We must flee!",
            "    remove_portrait;Leod",
            "    move_unit;Leod;21, 3;normal;push;60",
            "    remove_unit;Leod;fade;east",
            "        add_portrait;Garvey;Left",
            "    s;Garvey;Get back you stupid-!",
            "    remove_portrait;Garvey",
            "    wait;250",
            "    move_unit;Lamonte;17, 3",
            "    interact_unit;Lamonte;Cutscene_2;crit1;Junk8;force_no_animation",
            "    kill_unit;Cutscene_2",
            "    wait;250",
            "    multi_add_portrait;Garvey;Right;Lamonte;Left",
            "    # After killing the other soldier the two guards talk about Leod running off and go look for him",
            "    speak;Garvey;Damnable fool's run off!",
            "    speak;Lamonte;Well, come on, then!{w} We have to find him!",
            "    s;Garvey;Rrgh...{w} Fine.{w} Idiot's gonna get us both killed...",
            "    s;Lamonte;He'll get himself killed first, and it's our job to keep that from happening.{w} Now, let's get a move on!",
            "    multi_remove_portrait;Garvey;Lamonte",
            "    wait;250",
            "    move_unit;Lamonte;21, 4;normal;push;no_block",
            "    move_unit;Garvey;21, 3;normal;push",
            "    remove_unit;Garvey;fade;east",
            "    remove_unit;Lamonte;fade;east",
            "    transition;close",
            "    remove_all_units",
            "    # Alleyway",
            "        end_skip",
            "    change_tilemap;Alleyway",
            "    add_weather;night",
            "    set_fog_of_war;gba;3",
            "    enable_fog_of_war;1",
            "    add_region;Alleyway1_1;5, 3;1, 1;vision;2",
            "    add_region;Alleyway1_2;10, 2;1, 1;vision;2",
            "    add_region;Alleyway1_3;14, 4;1, 1;vision;2",
            "    add_region;Alleyway1_4;2, 9;1, 1;vision;2",
            "    add_region;Alleyway1_5;6, 9;1, 1;vision;2",
            "    add_region;Alleyway1_6;10, 9;1, 1;vision;2",
            "    add_region;Alleyway1_7;13, 9;1, 1;vision;2",
            "    music;Pandemonium",
            "    transition;open;500",
            "    location_card;Later...",
            "    add_unit;Leod;7, 9;fade;push;south",
            "    wait;500",
            "    add_portrait;Leod;Left",
            "    # Night time. Scared and alone, Leod finds himself in the alleyway from earlier.",
            "    speak;Leod;No...{w}{c:bop_portrait;Leod} no no no no no, I have to...{w} get away...{w} get away!",
            "    remove_portrait;Leod",
            "    wait;250",
            "    move_unit;Leod;0, 5;normal;no_block",
            "    add_unit;Garvey;7, 9;fade;push;south",
            "    wait;250",
            "    move_unit;Garvey;2, 4;normal;push",
            "    wait;250",
            "    add_unit;Lamonte;7, 9;fade;push;south",
            "    wait;500",
            "    # Garvey runs in the direction of Leod",
            "    speak;???;LEOD!;top_left;50",
            "    speak;Leod;AH!;top_left;50",
            "    flicker_cursor;1, 4",
            "    sound;Attack Hit 1",
            "    show_layer;Crates",
            "    flicker_cursor;1, 4",
            "    flicker_cursor;2, 5",
            "    flicker_cursor;1, 6",
            "    remove_unit;Leod;fade;west",
            "    move_unit;Garvey;8, 9;normal;push",
            "    wait;250",
            "    multi_add_portrait;Lamonte;Left;Garvey;Right",
            "    # Garvey goesback to Lamonte telling him Leod knocked over the crates and they'll have to go around",
            "    speak;Garvey;Bumbling prick knocked over the damn crates!{w}{clear}We're gonna have to go the long way around.",
            "    s;Lamonte;Damn!{w} Tonight just keeps getting better and better...",
            "    s;Garvey;Heh...{w} Tell me about it... ",
            "    multi_remove_portrait;Lamonte;Garvey",
            "    remove_unit;Lamonte;fade;south",
            "    remove_unit;Garvey;fade;south",
            "    wait;500",
            "    transition;close;500",
            "        end_skip",
            "    change_tilemap;Ch2",
            "    # Plaza",
            "    add_weather;night",
            "    set_fog_of_war;gba;3",
            "    enable_fog_of_war;1",
            "    add_region;House1;3, 15;1,1;event;<yellow>Visit</yellow>;only_once",
            "    add_region;House2;17, 14;1,1;event;<yellow>Visit</yellow>;only_once",
            "    add_region;VisionTopLeft;14, 2;1, 1;vision;2",
            "    add_region;VisionTopRight;18, 2;1, 1;vision;2",
            "    add_region;VisionBotLeft;3, 15;1, 1;vision;2",
            "    add_region;VisionBotMid;11, 12;1, 1;vision;3",
            "    add_region;VisionBotRight;17, 14;1, 1;vision;2",
            "    add_region;Form1;4, 0;1,1;formation",
            "    add_region;Form2;6, 0;1,1;formation",
            "    add_region;Form3;5, 1;1,1;formation",
            "    add_region;Form4;7, 1;1,1;formation",
            "    add_region;Form5;4, 2;1,1;formation",
            "    add_region;Form6;6, 2;1,1;formation",
            "    show_layer;Boxes",
            "    move_cursor;19, 10",
            "    transition;open;250",
            "    add_unit;Leod;19, 10;fade;push;east",
            "    wait;250",
            "    move_unit;Leod;11, 13;normal;push",
            "    add_portrait;Leod;Right",
            "    # Leod finds himself in the plaza and heads to the church. Door's locked.",
            "    # He hears footsteps and surrounds himself in crates.",
            "    speak;Leod;Locked...{w} locked, locked, WHY is the door locked!?{c:bop_portrait;Leod}{w} Somebody open up!{w} I'm the mayor!{w} {c:bop_portrait;Leod}I am YOUR mayor, and I demand-",
            "    s;???;You hear that?{w} The mayor's around here somewhere!;top",
            "    remove_portrait;Leod",
            "    transition;close",
            "    if;game.mode.nid == 'Lunatic'",
            "        remove_region;VisionTopLeft",
            "        remove_region;VisionTopRight",
            "        remove_region;VisionBotLeft",
            "        remove_region;VisionBotMid",
            "        remove_region;VisionBotRight",
            "    end",
            "    hide_layer;Boxes",
            "    add_unit;Barrel_1;10, 13;immediate",
            "    add_unit;Barrel_3;11, 14;immediate",
            "    add_unit;Barrel_5;12, 13;immediate",
            "        end_skip",
            "    move_cursor;3, 0;immediate",
            "    transition;open;500",
            "    location_card;Moments later...",
            "    wait;500",
            "    add_unit;Alpin;4, 0;fade;stack;north",
            "    add_unit;Carlin;4, 0;fade;stack;north",
            "    add_unit;Raelin;5, 0;fade;stack;north",
            "    add_unit;Shayla;6, 0;fade;stack;north",
            "    add_unit;Elwynn;6, 0;fade;push;north",
            "    move_unit;Alpin;4, 2;normal;push;no_block",
            "    move_unit;Shayla;6, 2;normal;push;no_block",
            "    move_unit;Raelin;5, 1;normal;push",
            "    wait;500",
            "    multi_add_portrait;Alpin;FarLeft;Carlin;MidLeft;Shayla;MidRight;Elwynn;FarRight",
            "    speak;Alpin;Almost there...{w} running...{w} out of breath...",
            "    s;Shayla;Heh...{w} I'd make fun of ya...{w} but I'm pooped, too...",
            "    s;Elwynn;It's the damn smoke in the air.{w} They're making a damn bonfire out of us...",
            "    remove_portrait;Shayla",
            "    add_portrait;Raelin;MidRight",
            "    s;Raelin;I just hope the church is still safe.",
            "    s;Carlin;It HAS to be.{w} The goddess wouldn't let them lay a finger on that place, right?{w} Especially not with the spear in there!",
            "    s;Elwynn;Wish I had your optimism, kid...",
            "    s;???;Elwynn!{w} Is that you!?;top_right",
            "    multi_remove_portrait;Alpin;Carlin;Raelin;Elwynn",
            "    music;A Glimmer Of Hope",
            "    move_cursor;19, 2",
            "    # Recruitment",
            "    sound;Unlock",
            "    show_layer;TopRight",
            "    end_skip",
            "    wait;250",
            "    add_unit;Quinley;18, 2;immediate",
            "    wait;250",
            "    sound;Unlock",
            "    show_layer;TopLeft",
            "    wait;250",
            "    add_unit;Saraid;14, 2;immediate",
            "    wait;250",
            "    move_unit;Quinley;18, 3;normal;no_block",
            "    move_unit;Saraid;14, 3;normal",
            "    sound;Unlock",
            "    hide_layer;TopLeft",
            "    wait;250",
            "    sound;Unlock",
            "    hide_layer;TopRight",
            "    wait;250",
            "    move_unit;Saraid;7, 1;normal;push;no_block",
            "    move_unit;Quinley;7, 3;normal;push",
            "    wait;250",
            "    change_team;Quinley;player",
            "    change_team;Saraid;player",
            "    wait;250",
            "    multi_add_portrait;Quinley;FarRight;Saraid;MidRight;Elwynn;Left",
            "    # Saraid and Quinley join the team",
            "    s;Elwynn;Q-Quinley!?{w} Oh, thank the goddess, you're alive!|I thought maybe...",
            "    s;Quinley;That makes two of us, then.{w} I thought for sure...",
            "    s;Saraid;Well, you're both wrong.{w} Good for you.|Guessing you're here for the same reason we are?",
            "    s;Elwynn;Aye.{w} Elspeth will know what to do.",
            "    s;Saraid;She'd better.{w} I busted my ass to keep this one safe, and I hardly even like her.",
            "    s;Quinley;Aww, you know you love me.|You wouldn't care so much if you didn't!",
            "    s;Saraid;See?{w} Annoying.{w}{clear}She's your problem now, El.{w} Or maybe you're her's?",
            "    s;Elwynn;Is now really the time for this?",
            "    s;Saraid;... Whatever.{w}{clear}Just hope you're sober enough to see -{w} it's dark, and we're not alone.",
            "    multi_remove_portrait;Quinley;Saraid;Elwynn",
            "    music;Hulking Step of the Empire",
            "        end_skip",
            "    spawn_group;Enemy1;west;0, 5;normal;stack",
            "    move_group;Enemy1;Enemy1Placement",
            "    add_group;Stationary;Stationary;immediate",
            "    wait;250",
            "    move_cursor;Brassfield",
            "    wait;250",
            "    multi_add_portrait;Brassfield;Right;SoldierPurple;Left",
            "    s;Brassfield;Search the area.{w} We've got reports the mayor's around here somewhere.|Some villagers putting up a resistance, too.{w} Shouldn't be an issue for you.",
            "    s;SoldierPurple;What do we do if we find the guy?",
            "    s;Brassfield;Orders are to kill on sight.{w} You know what to do.",
            "    bop_portrait;SoldierPurple",
            "    s;SoldierPurple;Yes, sir!",
            "    remove_portrait;SoldierPurple",
            "    s;Brassfield;... \"Kill on sight\"...{w} \"Spare no one\"...|What the hell are they thinking?{w} Pah.",
            "    expression;Brassfield;CloseEyes",
            "    s;Brassfield;You know...|It's pretty dark out...",
            "    expression;Brassfield;OpenEyes",
            "    s;Brassfield;As long as they don't pick a fight with me...{w} I could just say I didn't see anybody.|Keep my hands clean of...{w} this.|Fingers crossed, I suppose...",
            "    remove_portrait;Brassfield",
            "    wait;250",
            "    move_cursor;Alpin",
            "    multi_add_portrait;Elwynn;MidLeft;Alpin;FarLeft;Quinley;FarRight;Saraid;MidRight",
            "    s;Elwynn;Crap...{w} surrounded again.|We were lucky to survive the last fight...",
            "    s;Quinley;If it weren't for Elspeth, I'd say we should just cut our losses and run.{w}{clear}Lucky or not, we're pretty outnumbered. ",
            "    s;Alpin;It... {w}it doesn't matter.",
            "    s;Saraid;Eh?{w} Kid, what're you-?",
            "    s;Alpin;If they want a fight, we'll fight!{w} It doesn't matter if they try to stop us!|With the lance...{w} we can do it!|We can save everyone!",
            "    s;Quinley;Huh!{w} Didn't expect a pupil of El's to be such an optimist!",
            "    s;Elwynn;It's a real pain sometimes...{w} but maybe the kid's right.|If we can reach the church, we just might have a way out of this.",
            "    s;Saraid;Then let's not waste time.",
            "    s;Alpin;Agreed.|Come on, everyone!",
            "    multi_remove_portrait;Alpin;Elwynn;Saraid;Quinley",
            "    remove_skill;Garvey;NPCVision;no_banner",
            "    remove_skill;Lamonte;NPCVision;no_banner",
            "    remove_skill;Leod;NPCVision;no_banner",
            "    remove_unit;Quinley",
            "    level_var;RaelinBrassfield;0",
            "    trigger_script;Global DeadUnitsRekill",
            "end",
            "",
            "inc_level_var;RoutEnemies;-1",
            "",
            "change_ai;Brassfield;AttackNoMove",
            "",
            "game_var;LeodDead;0",
            "level_var;BrassfieldQuote;0",
            "level_var;BossMusic;0",
            "game_var;BrassfieldDead;0",
            "level_var;DeadPlayers;0",
            "level_var;BrokenBarrel;0",
            "",
            "give_item;Brassfield;AngelFeather;no_banner;droppable",
            "",
            "if;game.mode.nid != 'Normal'",
            "    change_objective_win;Rout Fodder,Within 10 Turns",
            "    change_objective_simple;Rout Fodder,Turns Left {eval:11-game.turncount}",
            "    change_stats;Brassfield;STR,1,SKL,1,DEF,1,RES,1;immediate",
            "end",
            "",
            "if;'{v:EnemyReverse}' == 'Reversal'",
            "    trigger_script;Global GenericsWR",
            "elif;'{v:EnemyReverse}' == 'Double'",
            "    trigger_script;Global GenericsDR",
            "end",
            "trigger_script;Global GenericsAutoLevel",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    trigger_script;1 LunaticInventories",
            "end",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    enable_convoy;f",
            "else",
            "    enable_convoy;t",
            "end",
            "",
            "",
            "if;'{v:Jukebox}' == 'I Wanna Rock!'",
            "    change_music;player_phase;Dealings In The Dark",
            "    change_music;enemy_phase;Dealings In The Dark",
            "    change_music;enemy2_phase;Dealings In The Dark",
            "    change_music;other_phase;Dealings In The Dark",
            "    prep;1;Prep Jam;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "elif;'{v:Jukebox}' == 'Play Some Grooves!'",
            "    change_music;player_phase;After Hours",
            "    change_music;enemy_phase;After Hours",
            "    change_music;enemy2_phase;After Hours",
            "    change_music;other_phase;After Hours",
            "    prep;1;TPWD;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "else",
            "    change_music;player_phase;Skirmish In The Shadows",
            "    change_music;enemy_phase;Skirmish In The Shadows",
            "    change_music;enemy2_phase;Skirmish In The Shadows",
            "    change_music;other_phase;Skirmish In The Shadows",
            "    prep;1;Before An Impossible Battlefield;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "end"
        ]
    }
]