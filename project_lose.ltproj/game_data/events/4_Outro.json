[
    {
        "name": "Outro",
        "trigger": "level_end",
        "level_nid": "4",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "if;not RECORDS.get(\"NormalCleared\")",
            "    unlock_difficulty;Hard",
            "    speak;;You've unlocked Hard Mode!;;;hint",
            "    update_record;NormalCleared;True",
            "end",
            "if;game.mode.nid == 'Hard' and not RECORDS.get(\"HardCleared\")",
            "    unlock_difficulty;Lunatic",
            "    speak;;You unlocked Lunatic Difficulty!;;;hint",
            "    update_record;HardCleared;True",
            "end",
            "",
            "if;{v:ShallcrossDead} == 1",
            "    transition;close",
            "    change_background;YourDidIt",
            "    transition;open",
            "    speak;;You broke the game!;;;hint",
            "end",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    if;{v:CawthorneDead} == 0 and {v:ShallcrossDead} == 0",
            "        # Ending 1: Cawthorne survived and he kills Alpin last. Pls make dramatic, k thx.",
            "        inc_level_var;Ch5Outro;1",
            "        transition;close",
            "        remove_all_units",
            "        add_unit;Shallcross;2, 8;immediate",
            "        add_unit;ShallcrossSoldier1;1, 8;immediate",
            "        add_unit;ShallcrossSoldier2;2, 9;immediate",
            "        add_unit;Alpin;11, 14;immediate",
            "        add_unit;Cawthorne;11, 11;immediate",
            "        add_unit;Keeva;1, 9;immediate",
            "        add_unit;101;7, 9;immediate",
            "        add_unit;102;14, 12;immediate",
            "        add_unit;103;13, 7;immediate",
            "        add_unit;104;9, 13;immediate",
            "        add_unit;105;15, 8;immediate",
            "        add_unit;106;9, 8;immediate",
            "        add_unit;107;17, 10;immediate",
            "        set_current_hp;Alpin;9",
            "        move_cursor;Alpin",
            "        transition;open;1000",
            "        flicker_cursor;Alpin",
            "        add_portrait;Alpin;Right",
            "        speak;Alpin;Ugh...",
            "        remove_portrait;Alpin",
            "        wait;250",
            "        flicker_cursor;Cawthorne",
            "        move_unit;Cawthorne;11, 12;normal;push;360;no_follow",
            "        wait;250",
            "        add_portrait;Cawthorne;Left",
            "        speak;Cawthorne;Done already?",
            "        remove_portrait;Cawthorne",
            "        flicker_cursor;Alpin",
            "        transition;close;1250",
            "        change_background;BlackBackground",
            "        transition;open;1250",
            "        add_portrait;Alpin;Right",
            "        speak;Alpin;[sad internal monologue]",
            "        transition;close;1250",
            "        remove_portrait;Alpin",
            "        change_background",
            "        transition;open;1250",
            "        flicker_cursor;Cawthorne",
            "        add_portrait;Cawthorne;Left",
            "        speak;Cawthorne;[filler]",
            "        remove_portrait;Cawthorne",
            "        move_unit;Cawthorne;11, 13;normal;push;30;no_follow",
            "        interact_unit;Cawthorne;Alpin;crit1,end;TheDefiler;force_animation",
            "        transition;close;5000",
            "        remove_all_units",
            "        change_background;BlackBackground",
            "        transition;open",
            "        # Text box appears to tell the player that eventually the good guys won; but the town never got rebuilt and the townspeople were pretty much forgotten.",
            "        speak;;You suck and you died!;;;hint",
            "    end",
            "    if;{v:CawthorneDead} == 1",
            "        # Ending 2: Alpin killed Cawthorne with the Reclaimer! ",
            "        # All other party members are dead, Alpin is on the ground, near death.",
            "        # Shallcross walks up to finish him off but Keeva intervenes, saying he could be useful.",
            "        # Keeva offers him a chance at revenge for the king by becoming the vessel of [EVIL GOD]",
            "        # He agrees and they all teleport out.",
            "        transition;close",
            "        remove_all_units",
            "        add_unit;Shallcross;6, 8;immediate",
            "        add_unit;Keeva;5, 7;immediate",
            "        add_unit;101;8, 9;immediate",
            "        move_cursor;Shallcross",
            "        transition;open",
            "        flicker_cursor;Shallcross",
            "        add_portrait;Shallcross;Left",
            "        speak;Shallcross;[filler]",
            "        remove_portrait;Shallcross",
            "        wait;250",
            "        move_unit;Shallcross;7, 9;normal;push;360;no_follow;no_block",
            "        flicker_cursor;101",
            "        add_portrait;Alpin;Right",
            "        speak;Alpin;Ugh...",
            "        remove_portrait;Alpin",
            "        add_portrait;Shallcross;Left",
            "        speak;Shallcross;[Filler]",
            "        remove_portrait;Shallcross",
            "        move_cursor;Keeva",
            "        add_portrait;Keeva;Left",
            "        speak;Keeva;Wait.",
            "        remove_portrait;Keeva",
            "        move_unit;Keeva;8, 8;warp;push",
            "        wait;500",
            "        multi_add_portrait;Shallcross;Left;Keeva;Right",
            "        speak;Shallcross;?",
            "        speak;Keeva;[Filler]",
            "        speak;Shallcross;[Filler]",
            "        multi_remove_portrait;Keeva;Shallcross",
            "        wait;250",
            "        remove_unit;101;warp",
            "        wait;250",
            "        remove_unit;Shallcross;warp",
            "        wait;250",
            "        add_portrait;Keeva;Right",
            "        speak;Keeva;[Filler]",
            "        remove_portrait;Keeva",
            "        remove_unit;Keeva;warp",
            "        wait;500",
            "        transition;close",
            "        change_tilemap;Castle Interior",
            "        add_unit;King;8, 7;immediate",
            "        add_unit;Keeva;10, 10;immediate",
            "        add_unit;Shallcross;6, 10;immediate",
            "        add_unit;EvilAlpin;8, 10;immediate",
            "        add_unit;108;6, 12;immediate",
            "        add_unit;109;8, 12;immediate",
            "        add_unit;110;10, 12;immediate",
            "        add_unit;111;7, 13;immediate",
            "        add_unit;112;9, 13;immediate",
            "        move_cursor;11, 2",
            "        transition;open;2500",
            "        location_card;A few weeks later...",
            "        multi_add_portrait;Shallcross;FarLeft;EvilAlpin;MidLeft;King;Right",
            "        # Timeskip to a few weeks later",
            "        # Evil kingdom has invaded the good kingdom, they're at the throneroom and all that's left is the king and a few soldiers",
            "        # Keeva kills off the mooks but leaves the king for Alpin",
            "        # EVIL Alpin gives the king some speech before killing him.",
            "        # Keeva gets the last McGuffin stone and Bad Guy Plan succeeds.",
            "        speak;Shallcross;[Filler]",
            "        speak;King;Filler",
            "        speak;Shallcross;Filler",
            "        speak;EvilAlpin;Filler",
            "        multi_remove_portrait;King;Shallcross;EvilAlpin",
            "        move_unit;EvilAlpin;8, 8;normal;push;30",
            "        interact_unit;EvilAlpin;King;crit1,end;TheReclaimer;force_animation",
            "        wait;250",
            "        flicker_cursor;Keeva",
            "        wait;250",
            "        move_unit;Keeva;8, 7;warp",
            "        wait;500",
            "        add_portrait;Keeva;Right",
            "        speak;Keeva;[Filler]",
            "        remove_portrait;Keeva",
            "        flicker_cursor;EvilAlpin",
            "        # Remove Alpin and summon demon king or some shit",
            "        transition;close;5000",
            "        remove_all_units",
            "        change_background;BlackBackground",
            "        transition;open",
            "        # Bad guys win! Tyrannical evil overlord time.",
            "        speak;;Bad guys win!;;;hint",
            "    end",
            "    ",
            "else",
            "    if;{v:CawthorneDead} == 0 and {v:ShallcrossDead} == 0",
            "        # Ending 1: Cawthorne survived and he kills Laisren last. Pls make dramatic, k thx.",
            "        inc_level_var;Ch5Outro;1",
            "        transition;close",
            "        remove_all_units",
            "        add_unit;Shallcross;2, 8;immediate",
            "        add_unit;ShallcrossSoldier1;1, 8;immediate",
            "        add_unit;ShallcrossSoldier2;2, 9;immediate",
            "        add_unit;Laisren;11, 14;immediate",
            "        add_unit;Cawthorne;11, 11;immediate",
            "        add_unit;Keeva;1, 9;immediate",
            "        add_unit;101;7, 9;immediate",
            "        add_unit;102;14, 12;immediate",
            "        add_unit;103;13, 7;immediate",
            "        add_unit;104;9, 13;immediate",
            "        add_unit;105;15, 8;immediate",
            "        add_unit;106;9, 8;immediate",
            "        add_unit;107;17, 10;immediate",
            "        set_current_hp;Laisren;9",
            "        move_cursor;Laisren",
            "        transition;open;1000",
            "        flicker_cursor;Laisren",
            "        add_portrait;Laisren;Right",
            "        speak;Laisren;Ugh...",
            "        remove_portrait;Laisren",
            "        wait;250",
            "        flicker_cursor;Cawthorne",
            "        move_unit;Cawthorne;11, 12;normal;push;360;no_follow",
            "        wait;250",
            "        add_portrait;Cawthorne;Left",
            "        speak;Cawthorne;Done already?",
            "        remove_portrait;Cawthorne",
            "        flicker_cursor;Laisren",
            "        transition;close;1250",
            "        change_background;BlackBackground",
            "        transition;open;1250",
            "        add_portrait;Laisren;Right",
            "        speak;Laisren;[sad internal monologue]",
            "        transition;close;1250",
            "        remove_portrait;Laisren",
            "        change_background",
            "        transition;open;1250",
            "        flicker_cursor;Cawthorne",
            "        add_portrait;Cawthorne;Left",
            "        speak;Cawthorne;[filler]",
            "        remove_portrait;Cawthorne",
            "        move_unit;Cawthorne;11, 13;normal;push;30;no_follow",
            "        interact_unit;Cawthorne;Laisren;crit1,end;TheDefiler;force_animation",
            "        transition;close;5000",
            "        remove_all_units",
            "        change_background;BlackBackground",
            "        transition;open",
            "        # Text box appears to tell the player that eventually the good guys won; but the town never got rebuilt and the townspeople were pretty much forgotten.",
            "        speak;;You suck and you died!;;;hint",
            "    end",
            "    if;{v:CawthorneDead} == 1",
            "        # Ending 2: Laisren killed Cawthorne with the Reclaimer! ",
            "        # All other party members are dead, Laisren is on the ground, near death.",
            "        # Shallcross walks up to finish him off but Keeva intervenes, saying he could be useful.",
            "        # Keeva offers him a chance at revenge for the king by becoming the vessel of [EVIL GOD]",
            "        # He agrees and they all teleport out.",
            "        transition;close",
            "        remove_all_units",
            "        add_unit;Shallcross;6, 8;immediate",
            "        add_unit;Keeva;5, 7;immediate",
            "        add_unit;101;8, 9;immediate",
            "        move_cursor;Shallcross",
            "        transition;open",
            "        flicker_cursor;Shallcross",
            "        add_portrait;Shallcross;Left",
            "        speak;Shallcross;[filler]",
            "        remove_portrait;Shallcross",
            "        wait;250",
            "        move_unit;Shallcross;7, 9;normal;push;360;no_follow;no_block",
            "        flicker_cursor;101",
            "        add_portrait;Laisren;Right",
            "        speak;Laisren;Ugh...",
            "        remove_portrait;Laisren",
            "        add_portrait;Shallcross;Left",
            "        speak;Shallcross;[Filler]",
            "        remove_portrait;Shallcross",
            "        move_cursor;Keeva",
            "        add_portrait;Keeva;Left",
            "        speak;Keeva;Wait.",
            "        remove_portrait;Keeva",
            "        move_unit;Keeva;8, 8;warp;push",
            "        wait;500",
            "        multi_add_portrait;Shallcross;Left;Keeva;Right",
            "        speak;Shallcross;?",
            "        speak;Keeva;[Filler]",
            "        speak;Shallcross;[Filler]",
            "        multi_remove_portrait;Keeva;Shallcross",
            "        wait;250",
            "        remove_unit;101;warp",
            "        wait;250",
            "        remove_unit;Shallcross;warp",
            "        wait;250",
            "        add_portrait;Keeva;Right",
            "        speak;Keeva;[Filler]",
            "        remove_portrait;Keeva",
            "        remove_unit;Keeva;warp",
            "        wait;500",
            "        transition;close",
            "        change_tilemap;Castle Interior",
            "        add_unit;King;8, 7;immediate",
            "        add_unit;Keeva;10, 10;immediate",
            "        add_unit;Shallcross;6, 10;immediate",
            "        add_unit;EvilLaisren;8, 10;immediate",
            "        add_unit;108;6, 12;immediate",
            "        add_unit;109;8, 12;immediate",
            "        add_unit;110;10, 12;immediate",
            "        add_unit;111;7, 13;immediate",
            "        add_unit;112;9, 13;immediate",
            "        move_cursor;11, 2",
            "        transition;open;2500",
            "        location_card;A few weeks later...",
            "        multi_add_portrait;Shallcross;FarLeft;EvilLaisren;MidLeft;King;Right",
            "        # Timeskip to a few weeks later",
            "        # Evil kingdom has invaded the good kingdom, they're at the throneroom and all that's left is the king and a few soldiers",
            "        # Keeva kills off the mooks but leaves the king for Laisren",
            "        # EVIL Laisren gives the king some speech before killing him.",
            "        # Keeva gets the last McGuffin stone and Bad Guy Plan succeeds.",
            "        speak;Shallcross;[Filler]",
            "        speak;King;Filler",
            "        speak;Shallcross;Filler",
            "        speak;EvilLaisren;Filler",
            "        multi_remove_portrait;King;Shallcross;EvilLaisren",
            "        move_unit;EvilLaisren;8, 8;normal;push;30",
            "        interact_unit;EvilLaisren;King;crit1,end;TheReclaimer;force_animation",
            "        wait;250",
            "        flicker_cursor;Keeva",
            "        wait;250",
            "        move_unit;Keeva;8, 7;warp",
            "        wait;500",
            "        add_portrait;Keeva;Right",
            "        speak;Keeva;[Filler]",
            "        remove_portrait;Keeva",
            "        flicker_cursor;EvilLaisren",
            "        # Remove Laisren and summon demon king or some shit",
            "        transition;close;5000",
            "        remove_all_units",
            "        change_background;BlackBackground",
            "        transition;open",
            "        # Bad guys win! Tyrannical evil overlord time.",
            "        speak;;Bad guys win!;;;hint",
            "    end",
            "end",
            "if;not has_achievement('12')",
            "    update_achievement;12;Flashback: Orla;Visit Orla's house with Orla in Ch5",
            "end",
            "if;not has_achievement('13')",
            "    update_achievement;13;Flashback: Elspeth and Orla;Visit Orla's house with Elspeth in Ch5",
            "end",
            "if;not has_achievement('14')",
            "    update_achievement;14;Flashback: Ailsa;Visit Ailsa's house with Ailsa in Ch5",
            "end",
            "if;not has_achievement('15')",
            "    update_achievement;15;Flashback: Elspeth and Ailsa;Visit Ailsa's house with Elspeth in Ch5",
            "end",
            "if;not has_achievement('24')",
            "    update_achievement;24;Beaten By A Buncha Kids;Deploy all trainees in Ch5 and have them survive",
            "end",
            "if;not has_achievement('25')",
            "    update_achievement;25;One Less War Crime;Cleared Ch5 without deploying any trainees",
            "end",
            "if;not has_achievement('26')",
            "    update_achievement;26;Gotoh The Bench;Clear Ch5 without deploying Laisren",
            "end",
            "if;not has_achievement('27')",
            "    update_achievement;27;You Weren't Supposed To Do That;Defeat Keeva in Ch5",
            "end",
            "if;not has_achievement('28')",
            "    update_achievement;28;Merely A Footnote;Clear Ch5 without killing Cawthorne",
            "end",
            "if;not has_achievement('29')",
            "    update_achievement;29;The Darkest Timeline;Clear Ch5 after killing Cawthorne",
            "end",
            "if;not has_achievement('30')",
            "    update_achievement;30;Stop Breaking The Game;Defeat Shallcross in Ch5",
            "end",
            "if;not has_achievement('31')",
            "    update_achievement;31;Not An Arena In Sight;Reach level 10 with a unit",
            "end",
            "if;not has_achievement('32')",
            "    update_achievement;32;The Same Kick, 10,000 Times;Reach Weapon Rank S with a unit",
            "end",
            "if;not has_achievement('33')",
            "    update_achievement;33;Everyone's An Edgelord;Clear the game without using any supports",
            "end",
            "if;not has_achievement('34')",
            "    update_achievement;34;Tunnel Vision;Clear the game without visiting houses, killing thieves, looting, or opening chests or doors",
            "end",
            "if;not has_achievement('35')",
            "    update_achievement;35;Instructions Unclear;Get the generic visit dialogue for every house",
            "end",
            "if;not has_achievement('36')",
            "    update_achievement;36;All That For Nothing;Keep all playable units alive throughout the game",
            "end",
            "if;not has_achievement('37')",
            "    update_achievement;37;One After One, By The Star-Dogged Moon;Kill all lieutenants in their starting chapters",
            "end",
            "if;not has_achievement('38')",
            "    update_achievement;38;Do Them Dirty, In Front Of They Squad;Kill all lieutenants and Cawthorne in Ch5",
            "end",
            "if;not has_achievement('39')",
            "    update_achievement;39;Hardly Trying;Clear the game killing Cawthorne on Hard Difficulty",
            "end",
            "if;not has_achievement('40')",
            "    update_achievement;40;Absolute Lunatic;Clear the game killing Cawthorne on Lunatic Difficulty",
            "end"
        ]
    }
]