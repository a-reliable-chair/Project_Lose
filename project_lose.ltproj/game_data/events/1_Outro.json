[
    {
        "name": "Outro",
        "trigger": "level_end",
        "level_nid": "1",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "if;not has_achievement('16') and {v:BrokenBarrel} == 0",
            "    update_achievement;16;Insurance Wouldn't Cover it!;Didn't let a crate break in Ch2",
            "    complete_achievement;16;1;banner",
            "end",
            "if;not has_achievement('17') and {v:LeodDead} == 0",
            "    update_achievement;17;It's The Right Thing To Do;Kept Leod alive in Ch2",
            "    complete_achievement;17;1;banner",
            "end",
            "if;not has_achievement('18') and {v:LeodDead} == 1",
            "    update_achievement;18;Meh, Never Liked Him Anyway;Let Leod die in Ch2",
            "    complete_achievement;18;1;banner",
            "end",
            "if;{v:RoutEnemies} == 0",
            "    inc_level_var;RoutEnemies;1",
            "end",
            "transition;close",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    remove_skill;Saraid;NPCVision;no_banner",
            "    remove_skill;Quinley;NPCVision;no_banner",
            "    show_layer;Box1",
            "    show_layer;Box3",
            "    show_layer;Box5",
            "    remove_all_units",
            "    enable_fog_of_war;false",
            "    music;Pandemonium",
            "    add_weather;night",
            "    add_unit;Laisren;9, 13;immediate",
            "    add_unit;Corridon;8, 14;immediate",
            "    add_unit;Orla;10, 14;immediate",
            "    add_unit;Ailsa;9, 15;immediate",
            "    add_unit;Elspeth;11, 15;immediate",
            "    add_unit;Garvey;12, 14;immediate",
            "    add_unit;Lamonte;13, 15;immediate",
            "    add_unit;Cutscene_5;15, 16;immediate;stack",
            "    move_cursor;17, 17",
            "    if;{v:LeodDead} == 0",
            "        remove_item;Leod;AngelFeather;no_banner",
            "        add_unit;Leod;11, 13;immediate",
            "    end",
            "    transition;open",
            "    # Party is standing outside of the church.",
            "    # Saraid and Quinley show up.",
            "    # A surviving enemy attacks Quinley but Leod warns him of it in time.",
            "    multi_add_portrait;Elspeth;MidRight;Lamonte;FarRight;Corridon;FarLeft;Orla;MidLeft",
            "    speak;Elspeth;filler",
            "    multi_remove_portrait;Elspeth;Lamonte;Corridon;Orla",
            "    flicker_cursor;15, 17",
            "    flicker_cursor;16, 17",
            "    if;{v:LeodDead} == 0",
            "        level_var;QuinleySkill;1",
            "        set_current_hp;Leod;8",
            "        add_unit;Quinley;15, 17;fade;push;south",
            "        add_unit;Saraid;16, 17;fade;push;south",
            "        add_portrait;Leod;Left",
            "        speak;Leod;filler",
            "        remove_portrait;Leod",
            "        flicker_cursor;Cutscene_5",
            "        add_unit;Cutscene_6;15, 16;immediate;stack",
            "        remove_unit;Cutscene_5;immediate",
            "        interact_unit;Cutscene_6;Quinley;miss1,crit2,end;Iron Axe;force_no_animation",
            "        kill_unit;Cutscene_6",
            "        add_portrait;Quinley;Right",
            "        speak;Quinley;filler!",
            "        remove_portrait;Quinley",
            "        wait;250",
            "        move_unit;Quinley;13, 14;normal",
            "        move_unit;Saraid;13, 13;normal",
            "        multi_add_portrait;Leod;Left;Quinley;MidRight;Saraid;FarRight",
            "        # Quinley and Saraid approach the party and Leod starts to call out Saraid on for what happened earlier.",
            "        # Saraid becomes an enemy, attacking Leon but he survives; Quinley kills Saraid. Quinley becomes playable.",
            "        # Rest of the party super confused.",
            "        speak;Leod;filler",
            "        multi_remove_portrait;Leod;Quinley;Saraid",
            "        flicker_cursor;Saraid",
            "        change_team;Saraid;enemy",
            "        wait;250",
            "        add_portrait;Saraid;Right",
            "        speak;Saraid;filler",
            "        remove_portrait;Saraid",
            "        interact_unit;Saraid;Leod;hit1,end;Bow7;force_no_animation",
            "        add_portrait;Leod;Left",
            "        speak;Leod;filler",
            "        remove_portrait;Leod",
            "        add_portrait;Quinley;Left",
            "        speak;Quinley;filler",
            "        remove_portrait;Quinley",
            "        # Quinley kills Saraid",
            "        set_current_hp;Saraid;5",
            "        interact_unit;Quinley;Saraid;crit1,end;Junk;force_no_animation",
            "        flicker_cursor;Quinley",
            "        change_team;Quinley;player",
            "        move_unit;Quinley;12, 13;normal;push",
            "        wait;250",
            "        multi_add_portrait;Leod;Left;Quinley;Right",
            "        speak;Quinley;filler",
            "        speak;Leod;filler",
            "        multi_remove_portrait;Leod;Quinley",
            "        transition;close;1000;255, 255, 255",
            "        change_tilemap;AlleywaySepia",
            "        add_unit;Crates;1, 4;immediate",
            "        resurrect;Saraid",
            "        change_team;Saraid;other",
            "        change_team;Quinley;other",
            "        transition;open;1000;255, 255, 255",
            "        location_card;Earlier...",
            "        add_unit;Leod;7, 9;fade;push;south",
            "        add_portrait;Leod;Left",
            "        # Flashback to earlier at the alleyway (same dialogue)",
            "        speak;Leod;filler",
            "        remove_portrait;Leod",
            "        wait;250",
            "        move_unit;Leod;0, 5;normal",
            "        add_unit;Saraid;7, 9;fade;push;south",
            "        wait;250",
            "        add_portrait;Saraid;Left",
            "        speak;Saraid;filler",
            "        remove_portrait;Saraid",
            "        move_unit;Saraid;2, 4;normal;push",
            "        wait;250",
            "        add_unit;Quinley;7, 9;fade;push;south",
            "        wait;500",
            "        speak;;LEOD!;top_left;50",
            "        # It's revealed that Saraid knocked over the crates to seperate Leod from them",
            "        flicker_cursor;Saraid",
            "        interact_unit;Saraid;1, 4;hit1,end;Bow1;force_no_animation",
            "        show_layer;Crates",
            "        speak;;AH!;top_left;50",
            "        remove_unit;Leod;fade;west",
            "        transition;close;1000;255, 255, 255",
            "        remove_all_units",
            "        change_tilemap;Ch2",
            "        add_weather;night",
            "        show_layer;Box1",
            "        show_layer;Box3",
            "        show_layer;Box5",
            "        move_cursor;17, 17",
            "        add_unit;Laisren;9, 13;immediate",
            "        add_unit;Corridon;8, 14;immediate",
            "        add_unit;Orla;10, 14;immediate",
            "        add_unit;Ailsa;9, 15;immediate",
            "        add_unit;Elspeth;11, 15;immediate",
            "        add_unit;Garvey;12, 14;immediate",
            "        add_unit;Lamonte;13, 15;immediate",
            "        add_unit;Leod;11, 13;immediate",
            "        add_unit;Quinley;12, 13;immediate",
            "        change_team;Quinley;player",
            "        transition;open;1000;255, 255, 255",
            "        # Back to the party",
            "        multi_add_portrait;Leod;MidLeft;Elspeth;FarLeft;Quinley;MidRight;Lamonte;FarRight",
            "        speak;Quinley;filler",
            "        multi_remove_portrait;Leod;Elspeth;Quinley;Lamonte",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        # Party is standing outside of the church.",
            "        # Saraid and Quinley show up.",
            "        # A surviving enemy attacks Quinley. Since Leod isn't there, the soldier kills Quinley and Saraid becomes playable.",
            "        add_unit;Quinley;15, 17;fade;push;south",
            "        set_current_hp;Quinley;4",
            "        add_unit;Saraid;16, 17;fade;push;south",
            "        wait;250",
            "        flicker_cursor;Cutscene_5",
            "        add_unit;Cutscene_6;15, 16;immediate;stack",
            "        remove_unit;Cutscene_5;immediate",
            "        interact_unit;Cutscene_6;Quinley;crit1,end;Steel Axe;1;force_no_animation",
            "        interact_unit;Saraid;Cutscene_6;crit1,end;Junk;force_no_animation",
            "        move_unit;Saraid;13, 13;normal",
            "        multi_add_portrait;Saraid;Right;Garvey;FarLeft;Lamonte;MidLeft",
            "        # The gang lament Quinley's death and Saraid asks about Leod",
            "        # He ded.",
            "        speak;Saraid;...",
            "        speak;Garvey;...",
            "        flicker_cursor;Saraid",
            "        change_team;Saraid;player",
            "        multi_remove_portrait;Saraid;Garvey;Lamonte",
            "        flicker_cursor;11, 12",
            "        sound;Unlock",
            "        show_layer;Mid",
            "        add_unit;Elwynn;11, 12;fade",
            "        flicker_cursor;Elwynn",
            "        add_portrait;Elwynn;Left",
            "        # Elwynn opens the church door, speaks with the party then lets them inside.",
            "        speak;Elwynn;filler",
            "        remove_portrait;Elwynn",
            "        remove_unit;Elwynn;fade",
            "        move_unit;Laisren;11, 12;normal;no_follow",
            "        remove_unit;Laisren;fade",
            "        move_unit;Corridon;11, 12;normal;no_follow",
            "        remove_unit;Corridon;fade",
            "        move_unit;Orla;11, 12;normal;no_follow",
            "        remove_unit;Orla;fade",
            "        move_unit;Ailsa;11, 12;normal;no_follow",
            "        remove_unit;Ailsa;fade",
            "        move_unit;Elspeth;11, 12;normal;;no_follow",
            "        remove_unit;Elspeth;fade",
            "        move_unit;Garvey;11, 12;normal;no_follow",
            "        remove_unit;Garvey;fade",
            "        move_unit;Lamonte;11, 12;normal;no_follow",
            "        remove_unit;Lamonte;fade",
            "    end",
            "    flicker_cursor;11, 12",
            "    sound;Unlock",
            "    show_layer;Mid",
            "    add_unit;Elwynn;11, 12;fade",
            "    flicker_cursor;Elwynn",
            "    add_portrait;Elwynn;Left",
            "    # Elwynn opens the church door, speaks with the party then lets them inside.",
            "    speak;Elwynn;filler",
            "    remove_portrait;Elwynn",
            "    remove_unit;Elwynn;fade",
            "    move_unit;Laisren;11, 12;normal;no_follow",
            "    remove_unit;Laisren;fade",
            "    move_unit;Corridon;11, 12;normal;no_follow",
            "    remove_unit;Corridon;fade",
            "    move_unit;Orla;11, 12;normal;no_follow",
            "    remove_unit;Orla;fade",
            "    move_unit;Ailsa;11, 12;normal;no_follow",
            "    remove_unit;Ailsa;fade",
            "    move_unit;Elspeth;11, 12;normal;;no_follow",
            "    remove_unit;Elspeth;fade",
            "    move_unit;Garvey;11, 12;normal;no_follow",
            "    remove_unit;Garvey;fade",
            "    move_unit;Lamonte;11, 12;normal;no_follow",
            "    remove_unit;Lamonte;fade",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Leod;11, 12;normal;no_follow",
            "        remove_unit;Leod;fade",
            "        move_unit;Quinley;11, 12;normal;no_follow",
            "        remove_unit;Quinley;fade",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Saraid;11, 12;normal;no_follow",
            "        remove_unit;Saraid;fade",
            "    end",
            "else",
            "    remove_skill;Garvey;NPCVision;no_banner",
            "    remove_skill;Lamonte;NPCVision;no_banner",
            "    show_layer;Box1",
            "    show_layer;Box3",
            "    show_layer;Box5",
            "    remove_all_units",
            "    enable_fog_of_war;false",
            "    music;Pandemonium",
            "    add_weather;night",
            "    add_unit;Alpin;9, 13;immediate",
            "    add_unit;Carlin;8, 14;immediate",
            "    add_unit;Shayla;10, 14;immediate",
            "    add_unit;Raelin;9, 15;immediate",
            "    add_unit;Elwynn;11, 15;immediate",
            "    add_unit;Saraid;12, 14;immediate",
            "    add_unit;Quinley;13, 15;immediate",
            "    add_unit;Cutscene_5;15, 16;immediate;stack",
            "    move_cursor;17, 17",
            "    if;{v:LeodDead} == 0",
            "        remove_item;Leod;AngelFeather;no_banner",
            "        add_unit;Leod;11, 13;immediate",
            "    end",
            "    transition;open",
            "    # Party is standing outside of the church.",
            "    # Garvey and Lamonte show up.",
            "    # A surviving enemy attacks Lamonte but Leod warns him of it in time.",
            "    multi_add_portrait;Elwynn;MidRight;Quinley;FarRight;Carlin;FarLeft;Shayla;MidLeft",
            "    speak;Elwynn;filler",
            "    multi_remove_portrait;Elwynn;Quinley;Carlin;Shayla",
            "    flicker_cursor;15, 17",
            "    flicker_cursor;16, 17",
            "    if;{v:LeodDead} == 0",
            "        set_current_hp;Leod;8",
            "        add_unit;Lamonte;15, 17;fade;push;south",
            "        add_unit;Garvey;16, 17;fade;push;south",
            "        add_portrait;Leod;Left",
            "        speak;Leod;filler",
            "        remove_portrait;Leod",
            "        flicker_cursor;Cutscene_5",
            "        add_unit;Cutscene_6;15, 16;immediate;stack",
            "        remove_unit;Cutscene_5;immediate",
            "        interact_unit;Cutscene_6;Lamonte;miss1,crit2,end;Iron Axe;force_no_animation",
            "        kill_unit;Cutscene_6",
            "        add_portrait;Lamonte;Right",
            "        speak;Lamonte;filler!",
            "        remove_portrait;Lamonte",
            "        wait;250",
            "        move_unit;Lamonte;13, 14;normal",
            "        move_unit;Garvey;13, 13;normal",
            "        multi_add_portrait;Leod;Left;Lamonte;MidRight;Garvey;FarRight",
            "        # Lamonte and Garvey approach the party and Leod starts to call out Garvey on for what happened earlier.",
            "        # Garvey becomes an enemy, attacking Leon but he survives; Lamonte kills Garvey. Lamonte becomes playable.",
            "        # Rest of the party super confused.",
            "        speak;Leod;filler",
            "        multi_remove_portrait;Leod;Lamonte;Garvey",
            "        flicker_cursor;Garvey",
            "        change_team;Garvey;enemy",
            "        wait;250",
            "        add_portrait;Garvey;Right",
            "        speak;Garvey;filler",
            "        remove_portrait;Garvey",
            "        interact_unit;Garvey;Leod;hit1,end;Bow7;force_no_animation",
            "        add_portrait;Leod;Left",
            "        speak;Leod;filler",
            "        remove_portrait;Leod",
            "        add_portrait;Lamonte;Left",
            "        speak;Lamonte;filler",
            "        remove_portrait;Lamonte",
            "        # Lamonte kills Garvey",
            "        set_current_hp;Garvey;5",
            "    inc_level_var;Lifeline;1",
            "        interact_unit;Lamonte;Garvey;crit1,end;Junk;force_no_animation",
            "        flicker_cursor;Lamonte",
            "        change_team;Lamonte;player",
            "        give_skill;Lamonte;Lifeline;no_banner",
            "        move_unit;Lamonte;12, 13;normal;push",
            "        wait;250",
            "        multi_add_portrait;Leod;Left;Lamonte;Right",
            "        speak;Lamonte;filler",
            "        speak;Leod;filler",
            "        multi_remove_portrait;Leod;Lamonte",
            "        transition;close;1000;255, 255, 255",
            "        change_tilemap;AlleywaySepia",
            "        add_unit;Crates;1, 4;immediate",
            "        resurrect;Garvey",
            "        change_team;Garvey;other",
            "        change_team;Lamonte;other",
            "        transition;open;1000;255, 255, 255",
            "        location_card;Earlier...",
            "        add_unit;Leod;7, 9;fade;push;south",
            "        add_portrait;Leod;Left",
            "        # Flashback to earlier at the alleyway (same dialogue)",
            "        speak;Leod;filler",
            "        remove_portrait;Leod",
            "        wait;250",
            "        move_unit;Leod;0, 5;normal",
            "        add_unit;Garvey;7, 9;fade;push;south",
            "        wait;250",
            "        add_portrait;Garvey;Left",
            "        speak;Garvey;filler",
            "        remove_portrait;Garvey",
            "        move_unit;Garvey;2, 4;normal;push",
            "        wait;250",
            "        add_unit;Lamonte;7, 9;fade;push;south",
            "        wait;500",
            "        speak;;LEOD!;top_left;50",
            "        # It's revealed that Garvey knocked over the crates to seperate Leod from them",
            "        flicker_cursor;Garvey",
            "        interact_unit;Garvey;1, 4;hit1,end;Bow1;force_no_animation",
            "        show_layer;Crates",
            "        speak;;AH!;top_left;50",
            "        remove_unit;Leod;fade;west",
            "        transition;close;1000;255, 255, 255",
            "        remove_all_units",
            "        change_tilemap;Ch2",
            "        add_weather;night",
            "        show_layer;Box1",
            "        show_layer;Box3",
            "        show_layer;Box5",
            "        move_cursor;17, 17",
            "        add_unit;Alpin;9, 13;immediate",
            "        add_unit;Carlin;8, 14;immediate",
            "        add_unit;Shayla;10, 14;immediate",
            "        add_unit;Raelin;9, 15;immediate",
            "        add_unit;Elwynn;11, 15;immediate",
            "        add_unit;Saraid;12, 14;immediate",
            "        add_unit;Quinley;13, 15;immediate",
            "        add_unit;Leod;11, 13;immediate",
            "        add_unit;Lamonte;12, 13;immediate",
            "        change_team;Lamonte;player",
            "        transition;open;1000;255, 255, 255",
            "        # Back to the party",
            "        multi_add_portrait;Leod;MidLeft;Elwynn;FarLeft;Lamonte;MidRight;Quinley;FarRight",
            "        speak;Lamonte;filler",
            "        multi_remove_portrait;Leod;Elwynn;Lamonte;Quinley",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        # Party is standing outside of the church.",
            "        # Garvey and Lamonte show up.",
            "        # A surviving enemy attacks Lamonte. Since Leod isn't there, the soldier kills Lamonte and Garvey becomes playable.",
            "        add_unit;Lamonte;15, 17;fade;push;south",
            "        set_current_hp;Lamonte;4",
            "        add_unit;Garvey;16, 17;fade;push;south",
            "        wait;250",
            "        flicker_cursor;Cutscene_5",
            "        add_unit;Cutscene_6;15, 16;immediate;stack",
            "        remove_unit;Cutscene_5;immediate",
            "        interact_unit;Cutscene_6;Lamonte;crit1,end;Steel Axe;1;force_no_animation",
            "        interact_unit;Garvey;Cutscene_6;crit1,end;Junk;force_no_animation",
            "        move_unit;Garvey;13, 13;normal",
            "        multi_add_portrait;Garvey;Right;Saraid;FarLeft;Quinley;MidLeft",
            "        # The gang lament Lamonte's death and Garvey asks about Leod",
            "        # He ded.",
            "        speak;Garvey;...",
            "        speak;Saraid;...",
            "        flicker_cursor;Garvey",
            "        change_team;Garvey;player",
            "        multi_remove_portrait;Garvey;Saraid;Quinley",
            "    end",
            "    flicker_cursor;11, 12",
            "    sound;Unlock",
            "    show_layer;Mid",
            "    add_unit;Elspeth;11, 12;fade",
            "    flicker_cursor;Elspeth",
            "    add_portrait;Elspeth;Left",
            "    # Elspeth opens the church door, speaks with the party then lets them inside.",
            "    speak;Elspeth;filler",
            "    remove_portrait;Elspeth",
            "    remove_unit;Elspeth;fade",
            "    move_unit;Alpin;11, 12;normal;no_follow",
            "    remove_unit;Alpin;fade",
            "    move_unit;Carlin;11, 12;normal;no_follow",
            "    remove_unit;Carlin;fade",
            "    move_unit;Shayla;11, 12;normal;no_follow",
            "    remove_unit;Shayla;fade",
            "    move_unit;Raelin;11, 12;normal;no_follow",
            "    remove_unit;Raelin;fade",
            "    move_unit;Elwynn;11, 12;normal;;no_follow",
            "    remove_unit;Elwynn;fade",
            "    move_unit;Saraid;11, 12;normal;no_follow",
            "    remove_unit;Saraid;fade",
            "    move_unit;Quinley;11, 12;normal;no_follow",
            "    remove_unit;Quinley;fade",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Leod;11, 12;normal;no_follow",
            "        remove_unit;Leod;fade",
            "        move_unit;Lamonte;11, 12;normal;no_follow",
            "        remove_unit;Lamonte;fade",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Garvey;11, 12;normal;no_follow",
            "        remove_unit;Garvey;fade",
            "    end",
            "end",
            "sound;Unlock",
            "hide_layer;Mid",
            "wait;500",
            "move_cursor;17, 17",
            "flicker_cursor;15, 17",
            "music;Imperial Audacity",
            "add_unit;Emberson;15, 17;fade;push;south",
            "add_unit;Cutscene_3;14, 17;fade;push;south",
            "add_unit;Cutscene_4;16, 17;fade;push;south",
            "move_unit;Emberson;11, 13;normal;push;no_block;no_follow",
            "move_unit;Cutscene_3;10, 14;normal;push;no_block;no_follow",
            "move_unit;Cutscene_4;12, 14;normal;push;no_follow",
            "wait;250",
            "add_portrait;Emberson;Left",
            "# The boss of Ch 3 shows up and tells his goons to burn the place and go inside.",
            "speak;Emberson;filler.",
            "remove_portrait;Emberson",
            "# Have Brassfield and Emberson meet?",
            "if;{v:BrassfieldDead} == 0",
            "    change_background;TownSunset",
            "    transition;open",
            "    add_portrait;Brassfield;Left",
            "    s;Brassfield;[I survived].",
            "    remove_portrait;Brassfield",
            "    wait;250",
            "end",
            "if;not has_achievement('4')",
            "    update_achievement;4;Flashback: Elwynn;Visit Elwynn's house with Elwynn in Ch2",
            "end",
            "if;not has_achievement('5')",
            "    update_achievement;5;Flashback: Saraid;Visit Elwynn's house with Saraid in Ch2",
            "end",
            "if;not has_achievement('6')",
            "    update_achievement;6;Flashback: Elspeth and Elwynn;Visit Elspeth's house with Elwynn in Ch2",
            "end",
            "if;not has_achievement('7')",
            "    update_achievement;7;Flashback: Elspeth and Quinley;Visit Elspeth's house with Quinley in Ch2",
            "end",
            "if;not has_achievement('16')",
            "    update_achievement;16;Insurance Wouldn't Cover It!;Don't let any crates get destroyed in Ch2",
            "end",
            "if;not has_achievement('17')",
            "    update_achievement;17;It's The Right Thing To Do;Don't let Leod die in Ch2",
            "end",
            "if;not has_achievement('18')",
            "    update_achievement;18;Meh, Never Liked Him Anyway;Let Leod die in Ch2",
            "end"
        ]
    }
]