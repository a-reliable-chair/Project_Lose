[
    {
        "name": "Outro",
        "trigger": "level_end",
        "level_nid": "1",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "if;not has_achievement('16') and {v:BrokenBarrel} == 0",
            "    update_achievement;16;Insurance Wouldn't Cover it!;Didn't let a crate break in Ch2",
            "    complete_achievement;16;1;banner",
            "end",
            "if;not has_achievement('17') and {v:LeodDead} == 0",
            "    update_achievement;17;It's The Right Thing To Do;Kept Leod alive in Ch2",
            "    complete_achievement;17;1;banner",
            "end",
            "if;not has_achievement('18') and {v:LeodDead} == 1",
            "    update_achievement;18;Meh, Never Liked Him Anyway;Let Leod die in Ch2",
            "    complete_achievement;18;1;banner",
            "end",
            "if;{v:RoutEnemies} == 0",
            "    inc_level_var;RoutEnemies;1",
            "end",
            "transition;close",
            "change_background;TownNight",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    if;{v:LeodDead} == 0",
            "        change_team;Quinley;player",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        change_team;Saraid;player",
            "    end",
            "else",
            "    trigger_script;Global DeadUnitsRevive",
            "    transition;close",
            "    change_background",
            "    remove_skill;Garvey;NPCVision;no_banner",
            "    remove_skill;Lamonte;NPCVision;no_banner",
            "    show_layer;Box1",
            "    show_layer;Box3",
            "    show_layer;Box5",
            "    remove_all_units",
            "    enable_fog_of_war;false",
            "    music;Pandemonium",
            "    add_weather;night",
            "    add_unit;Alpin;9, 13;immediate",
            "    add_unit;Carlin;8, 14;immediate",
            "    add_unit;Shayla;10, 14;immediate",
            "    add_unit;Raelin;9, 15;immediate",
            "    add_unit;Elwynn;11, 15;immediate",
            "    add_unit;Saraid;12, 14;immediate",
            "    add_unit;Quinley;13, 15;immediate",
            "    add_unit;Cutscene_5;15, 16;immediate;stack",
            "    move_cursor;17, 17",
            "    if;{v:LeodDead} == 0",
            "        remove_item;Leod;AngelFeather;no_banner",
            "        add_unit;Leod;11, 13;immediate",
            "    end",
            "    transition;open",
            "    # Party is standing outside of the church.",
            "    # Garvey and Lamonte show up.",
            "    # A surviving enemy attacks Lamonte but Leod warns him of it in time.",
            "    multi_add_portrait;Alpin;Left;Elwynn;Right",
            "    s;Elwynn;That looks to be the last of 'em.",
            "    s;Alpin;Finally... ",
            "        end_skip",
            "    if;{v:LeodDead} == 0",
            "        remove_portrait;Alpin",
            "        add_portrait;Leod;Left",
            "        s;Leod;My thanks, all of you.{w} You've done the town a great service tonight!",
            "        s;Elwynn;What town?{w} The town they're burning to the ground?|There's nothing left to service.",
            "        s;Leod;Ah.{w} You're Elspeth's brother, yes?|I see the stories aren't far from the mark.{w}{clear}Yes, well...{w} my apologies for attempting to express my gratitude. ",
            "        s;Lamonte;Leod!{w} Is that you,{br} my man?;bottom_right",
            "        multi_remove_portrait;Leod;Elwynn",
            "        set_current_hp;Leod;8",
            "        flicker_cursor;15, 17",
            "        flicker_cursor;16, 17",
            "        add_unit;Lamonte;15, 17;fade;push;south",
            "        add_unit;Garvey;16, 17;fade;push;south",
            "        add_portrait;Leod;Left",
            "        s;Leod;Lamonte?{w} My word, look out behind you!",
            "        remove_portrait;Leod",
            "        flicker_cursor;Cutscene_5",
            "        add_unit;Cutscene_6;15, 16;immediate;stack",
            "        remove_unit;Cutscene_5;immediate",
            "        interact_unit;Cutscene_6;Lamonte;miss1,crit2,end;Iron Axe;force_no_animation",
            "        kill_unit;Cutscene_6",
            "        wait;250",
            "        move_unit;Lamonte;13, 14;normal",
            "        move_unit;Garvey;13, 13;normal",
            "        multi_add_portrait;Leod;Left;Lamonte;Right",
            "        s;Lamonte;Damn, they're relentless!{w}{c:expression;Lamonte;Smile,CloseEyes} Heh...{w} Some bodyguard I am, eh?{w}{clear}{c:expression;Lamonte;Smile,OpenEyes}Turns out it's you who saved my hide!",
            "        bop_portrait;Leod",
            "        s;Leod;Hmhmhm, yes, indeed!|Where would you be without me, hm?",
            "        s;Lamonte;...{w} Honest to goodness, when we lost sight of you, I thought that was gonna be it.|That we'd find you face-down in the street, or...",
            "        move_portrait;Lamonte;MidLeft",
            "        move_portrait;Leod;FarLeft",
            "        add_portrait;Garvey;FarRight",
            "        mirror_portrait;Lamonte",
            "        s;Garvey;Ahem.{w} Thought for sure you'd be dead.",
            "        s;Leod;Garvey...?{w} I don't believe it...{w} you!|You have the GALL to show your face!?",
            "        mirror_portrait;Lamonte",
            "        s;Lamonte;Huh?{w} Sir, Garvey was just as worried as I was, honest!|He even said-",
            "        mirror_portrait;Lamonte",
            "        s;Garvey;The mayor might be a bit confused.|It's been a rough night, after all.",
            "        s;Leod;Confused!?{w} CONFUSED!?{w}{clear}You tried to KILL me, you treasonous little rat!",
            "        mirror_portrait;Lamonte",
            "        s;Lamonte;Kill you!?{w} Naw, that's not Garvey.|He'd never-!",
            "        bop_portrait;Leod",
            "        s;Leod;He did!{w} He did, and goddess damn his soul, it nearly worked, too!",
            "        s;Garvey;... Ah, to hell with this.",
            "        bop_portrait;Lamonte",
            "        mirror_portrait;Lamonte",
            "        s;Lamonte;Garvey!?",
            "        expression;Garvey;Smile",
            "        s;Garvey;If I'm going down, I'm taking you with me!",
            "        # Lamonte and Garvey approach the party and Leod starts to call out Garvey on for what happened earlier.",
            "        # Garvey becomes an enemy, attacking Leon but he survives; Lamonte kills Garvey. Lamonte becomes playable.",
            "        # Rest of the party super confused.",
            "        multi_remove_portrait;Leod;Lamonte;Garvey",
            "        flicker_cursor;Garvey",
            "        change_team;Garvey;enemy",
            "        wait;250",
            "        interact_unit;Garvey;Leod;hit1,end;Bow7;force_no_animation",
            "        wait;250",
            "        # Lamonte kills Garvey",
            "        set_current_hp;Garvey;5",
            "        inc_level_var;Lifeline;1",
            "        interact_unit;Lamonte;Garvey;crit1,end;Junk10;force_no_animation",
            "        flicker_cursor;Lamonte",
            "        change_team;Lamonte;player",
            "        give_skill;Lamonte;Lifeline;no_banner",
            "        move_unit;Lamonte;12, 13;normal;push",
            "        wait;250",
            "        multi_add_portrait;Leod;Left;Lamonte;Right",
            "        s;Lamonte;Leod.{w} Sir.{w} What...|what happened here?{w} Did he really try to...?",
            "        s;Leod;That's right, my good man.|It was after we got separated...",
            "        multi_remove_portrait;Leod;Lamonte",
            "        transition;close;1000;255, 255, 255",
            "            end_skip",
            "        change_tilemap;AlleywaySepia",
            "        add_unit;Crates;1, 4;immediate",
            "        resurrect;Garvey",
            "        change_team;Garvey;other",
            "        change_team;Lamonte;other",
            "        transition;open;1000;255, 255, 255",
            "        location_card;Earlier...",
            "        add_unit;Leod;7, 9;fade;push;south",
            "        add_portrait;SLeod;Left",
            "        # Flashback to earlier at the alleyway (same dialogue)",
            "        speak;SLeod;Ahh!{w} N-n-no!{w} We must flee!",
            "        remove_portrait;SLeod",
            "        wait;250",
            "        move_unit;Leod;0, 5;normal",
            "        add_unit;Garvey;7, 9;fade;push;south",
            "        wait;250",
            "        add_portrait;SGarvey;Left",
            "        s;SGarvey;Get back you stupid-!",
            "        remove_portrait;SGarvey",
            "        move_unit;Garvey;2, 4;normal;push",
            "        wait;250",
            "        add_unit;Lamonte;7, 9;fade;push;south",
            "        wait;500",
            "        speak;Garvey;LEOD!;top_left;50",
            "        # It's revealed that Garvey knocked over the crates to seperate Leod from them",
            "        flicker_cursor;Garvey",
            "        interact_unit;Garvey;1, 4;hit1,end;Bow1;force_no_animation",
            "        show_layer;Crates",
            "        speak;;AH!;top_left;50",
            "        multi_add_portrait;SLeod;Left;SGarvey;Right",
            "        expression;SGarvey;Smile",
            "        s;SGarvey;What's wrong, Leod?{w} Can't survive without your precious bodyguards?",
            "        s;SLeod;Garvey!?{w} What is the meaning of this!?",
            "        s;SGarvey;Call it payback.{w} If I were you, I'd start running{semicolon}{w} the empire's looking for you,{w} and you just ran out of places to run.",
            "        bop_portrait;Leod",
            "        s;SLeod;You...{w}{c:bop_portrait;SLeod} You'll pay for this!!",
            "        s;SGarvey;Nah.{w} I don't think I will.|Good luck out there, though!",
            "        multi_remove_portrait;SGarvey;SLeod",
            "        remove_unit;Leod;fade;west",
            "        transition;close;1000;255, 255, 255",
            "        remove_all_units",
            "            end_skip",
            "        change_tilemap;Ch2",
            "        add_weather;night",
            "        show_layer;Box1",
            "        show_layer;Box3",
            "        show_layer;Box5",
            "        move_cursor;17, 17",
            "        add_unit;Alpin;9, 13;immediate",
            "        add_unit;Carlin;8, 14;immediate",
            "        add_unit;Shayla;10, 14;immediate",
            "        add_unit;Raelin;9, 15;immediate",
            "        add_unit;Elwynn;11, 15;immediate",
            "        add_unit;Saraid;12, 14;immediate",
            "        add_unit;Quinley;13, 15;immediate",
            "        add_unit;Leod;11, 13;immediate",
            "        add_unit;Lamonte;12, 13;immediate",
            "        change_team;Lamonte;player",
            "        transition;open;1000;255, 255, 255",
            "        # Back to the party",
            "        multi_add_portrait;Leod;MidLeft;Elwynn;FarLeft;Lamonte;MidRight;Saraid;FarRight",
            "        expression;Lamonte;CloseEyes",
            "        s;Lamonte;Then everything he said to me...|{c:expression;Elwynn;HalfCloseEyes}was it all a lie?",
            "        s;Leod;Hmph.{w} I wouldn't put it past the man.|A snake to the very last.{w}{clear}Suppose you could say he died as he lived!",
            "        expression;Elwynn;CloseEyes",
            "        s;Elwynn;Can't even trust our own people...{w}{c:expression;Elwynn;HalfCloseEyes} what a sorry state of affairs.",
            "        expression;Elwynn;OpenEyes",
            "        s;Saraid;Dunno if the whole town's gone to hell, or if it was always like this,|but I don't like it either way.",
            "        remove_portrait;Leod",
            "        add_portrait;Alpin;MidLeft",
            "        s;Alpin;Not the whole town...{w} Elspeth can be trusted.{w} Right?",
            "        remove_portrait;Saraid",
            "        add_portrait;Quinley;FarRight",
            "        expression;Quinley;Smile",
            "        bop_portrait;Quinley",
            "        s;Quinley;Of course she can!{w}{clear}I bet you she's about to open this door right about-",
            "        multi_remove_portrait;Alpin;Elwynn;Lamonte;Quinley",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        # Party is standing outside of the church.",
            "        # Garvey and Lamonte show up.",
            "        # A surviving enemy attacks Lamonte. Since Leod isn't there, the soldier kills Lamonte and Garvey becomes playable.",
            "        add_portrait;Quinley;Left",
            "        s;Elwynn;Shame about the mayor.{w}{clear}Though, now that I think about it,{w} maybe we're better off without him...",
            "        bop_portrait;Quinley",
            "        s;Quinley;Hey!{w} That's a terrible thing to say!",
            "        s;Elwynn;Yeah, yeah, whatever...",
            "        s;???;No...{w} is that...{w} who I think it is?",
            "        multi_remove_portrait;Quinley;Elwynn",
            "        flicker_cursor;15, 17",
            "        flicker_cursor;16, 17",
            "        add_unit;Lamonte;15, 17;fade;push;south",
            "        set_current_hp;Lamonte;4",
            "        add_unit;Garvey;16, 17;fade;push;south",
            "        wait;250",
            "        multi_add_portrait;Lamonte;Left;Garvey;Right",
            "        s;Garvey;Ah, don't be so hard on yourself.{w} Running off like he did, man had a death wish.",
            "        s;Lamonte;It's a tragedy no matter who's fault it is.{w}{clear}If I had stayed closer to him, maybe-",
            "        multi_remove_portrait;Garvey;Lamonte",
            "        flicker_cursor;Cutscene_5",
            "        add_portrait;Lamonte;Left",
            "        s;Lamonte;What the-!?",
            "        remove_portrait;Lamonte",
            "        add_unit;Cutscene_6;15, 16;immediate;stack",
            "        remove_unit;Cutscene_5;immediate",
            "        interact_unit;Cutscene_6;Lamonte;crit1,end;Steel Axe;1;force_no_animation",
            "        interact_unit;Garvey;Cutscene_6;crit1,end;Junk9;force_no_animation",
            "        move_unit;Garvey;13, 13;normal",
            "        multi_add_portrait;Elwynn;MidRight;Garvey;FarRight;Saraid;FarLeft;Alpin;MidLeft",
            "        # The gang lament Lamonte's death and Garvey asks about Leod",
            "        # He ded.",
            "        expression;Garvey;CloseEyes",
            "        s;Garvey;Lamonte...",
            "        s;Elwynn;More good men, dead for nothing.|What a waste...",
            "        s;Garvey;...{w}{c:expression;Garvey;OpenEyes} He was a prick, but he was the only prick to give a damn about me.",
            "        s;Alpin;It happened so fast...{w} I didn't even have time to-",
            "        bop_portrait;Saraid",
            "        s;Saraid;Stop it, kid.{w} Thinking like that's pointless.|Just leads to maybes and what ifs.",
            "        bop_portrait;Alpin",
            "        s;Alpin;But what if-!|I-I mean...{w} you're right.",
            "        remove_portrait;Alpin",
            "        add_portrait;Quinley;MidLeft",
            "        s;Quinley;...{w}Wynn.{w} We have to find Elspeth.",
            "        s;Elwynn;Aye.{w} Let's not waste any more time.",
            "        multi_remove_portrait;Garvey;Saraid;Quinley;Elwynn",
            "        flicker_cursor;Garvey",
            "        change_team;Garvey;player",
            "    end",
            "        end_skip",
            "    flicker_cursor;11, 12",
            "    move_unit;Elwynn;11,13;normal;push",
            "    add_portrait;Elwynn;Left",
            "    s;Elwynn;Elspeth!{w} If you're in there, open up!",
            "    remove_portrait;Elwynn",
            "    wait;250",
            "    music;Sanctuary",
            "    sound;Unlock",
            "    show_layer;Mid",
            "    add_unit;Elspeth;11, 12;fade",
            "    flicker_cursor;Elspeth",
            "    add_portrait;Elspeth;Right",
            "    # Elspeth opens the church door, speaks with the party then lets them inside.",
            "    s;Elspeth;Goddess preserves!{w} Quinley, Elwynn, I thought I'd lost you!",
            "    multi_add_portrait;Quinley;MidLeft;Elwynn;FarLeft",
            "    s;Quinley;You look like you've been crying...|I'm so sorry we worried you.|I-I'd thought the same thing.",
            "    s;Elwynn;Good thing we found each other when we did, or our fears would've all been proven right.",
            "    s;Elspeth;And what of the children?|Are they...?",
            "    multi_remove_portrait;Elwynn;Quinley",
            "    multi_add_portrait;Alpin;FarLeft;Shayla;MidLeft",
            "    s;Alpin;We're right here!",
            "    s;Elspeth;Oh, my poor dears, that blood on your tunic...{w} I'm so sorry.|Nobody so young should be forced to take a life.",
            "    s;Shayla;We did what we have to.|And we're not gonna stop, either.",
            "    remove_portrait;Alpin",
            "    add_portrait;Raelin;FarLeft",
            "    s;Raelin;Y-yeah!{w} Even if it's scary, there's still people we could help!|So we gotta keep fighting!",
            "    remove_portrait;Raelin",
            "    add_portrait;Carlin;FarLeft",
            "    s;Carlin;I...{w} I don't want to do this anymore.",
            "    s;Shayla;Huh?{w} What, you're giving up!?",
            "    s;Carlin;No, of course not.{w} I just...{w} don't want to do this.{w} But I will.",
            "    s;Elspeth;...{w} Even if we survive this day, perhaps a part of us will have died all the same.|Such tragedies neither discriminate nor take half-measures.|If there is something to kill...{w} it will be killed.",
            "    multi_remove_portrait;Carlin;Shayla",
            "    add_portrait;Quinley;Left",
            "    move_portrait;Elspeth;Right",
            "    s;Quinley;Are you alright?|This isn't like you.",
            "    s;Elspeth;No, it's...|it's not like me at all.",
            "    expression;Elspeth;CloseEyes",
            "    s;Elspeth;My apologies, I should-{w} no, I must do better than this.",
            "    expression;Elspeth;OpenEyes",
            "    s;Elspeth;All of you, come inside.|We'll discuss our next move together.",
            "    multi_remove_portrait;Elspeth;Quinley",
            "    remove_unit;Elspeth;fade",
            "    move_unit;Alpin;11, 12;normal;no_follow",
            "    remove_unit;Alpin;fade",
            "    move_unit;Carlin;11, 12;normal;no_follow",
            "    remove_unit;Carlin;fade",
            "    move_unit;Shayla;11, 12;normal;no_follow",
            "    remove_unit;Shayla;fade",
            "    move_unit;Raelin;11, 12;normal;no_follow",
            "    remove_unit;Raelin;fade",
            "    move_unit;Elwynn;11, 12;normal;;no_follow",
            "    remove_unit;Elwynn;fade",
            "    move_unit;Saraid;11, 12;normal;no_follow",
            "    remove_unit;Saraid;fade",
            "    move_unit;Quinley;11, 12;normal;no_follow",
            "    remove_unit;Quinley;fade",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Leod;11, 12;normal;no_follow",
            "        remove_unit;Leod;fade",
            "        move_unit;Lamonte;11, 12;normal;no_follow",
            "        remove_unit;Lamonte;fade",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Garvey;11, 12;normal;no_follow",
            "        remove_unit;Garvey;fade",
            "    end",
            "    sound;Unlock",
            "    hide_layer;Mid",
            "    trigger_script;Global DeadUnitsRekill",
            "        end_skip",
            "    if;{v:BrassfieldDead} == 0",
            "        transition;close",
            "        music;Imperial Audacity",
            "        change_background;TownNight",
            "        transition;open",
            "        multi_add_portrait;Brassfield;Left;Emberson;OffscreenRight",
            "        s;Brassfield;...",
            "        move_portrait;Emberson;Right",
            "        s;Emberson;Ah, I see you managed to survive.{w}{clear}Will you be joining us, then?",
            "        s;Brassfield;...{w} No, I think not.{w}{clear}We already go too far, yet you would put them to the torch?{w}{clear}I will have no part in this.",
            "        expression;Emberson;Smile",
            "        s;Emberson;You don't like my methods?{w} Whatever.|More of 'em for me, I suppose.",
            "        expression;Brassfield;CloseEyes",
            "        s;Brassfield;Yes...{w} I suppose indeed.",
            "        s;Emberson;...{w} Watch yourself, Brassfield.{w}{clear}I don't give a damn who's side your on,{w} as long as you stay out of my way.|The others, though...{w} might not be so forgiving.",
            "        expression;Brassfield;OpenEyes",
            "        s;Brassfield;Duly noted.{w} Don't you worry, Emberson{semicolon}{w} I'll leave you to your work.",
            "        remove_portrait;Emberson",
            "        s;Brassfield;...",
            "        remove_portrait;Brassfield",
            "        wait;250",
            "        transition;close",
            "        change_background",
            "        transition;open",
            "    end",
            "    wait;500",
            "        end_skip",
            "    move_cursor;17, 17",
            "    flicker_cursor;15, 17",
            "    music;Imperial Audacity",
            "    add_unit;Emberson;15, 17;fade;push;south",
            "    wait;500",
            "    add_portrait;Emberson;Left",
            "    s;Emberson;Look at 'em scurry for their cellar, as though a little shelter could weather our storm.{w}{clear}Boys!",
            "    remove_portrait;Emberson",
            "    wait;500",
            "    add_unit;Cutscene_3;14, 17;fade;push;south",
            "    add_unit;Cutscene_4;16, 17;fade;push;south",
            "    wait;250",
            "    add_portrait;Emberson;Left",
            "    s;Emberson;We're going in.{w} Bring the torches.{w}{clear}We'll smoke 'em out,{w} kill the whole lot of 'em,{w} and grab the treasure to boot.",
            "    remove_portrait;Emberson",
            "    move_unit;Emberson;11, 13;normal;push",
            "    wait;250",
            "    move_unit;Cutscene_3;10, 14;normal;push;no_block;no_follow",
            "    move_unit;Cutscene_4;12, 14;normal;push;no_follow",
            "    wait;250",
            "    add_portrait;Emberson;Left",
            "    s;Emberson;So, they wanna fight, eh?{w}{clear}Let's see how much fight they got in 'em{w} after they watch their precious church burn to ashes!",
            "    remove_portrait;Emberson",
            "end",
            "music_clear",
            "",
            "if;not has_achievement('4')",
            "    update_achievement;4;Flashback: Elwynn;Visit Elwynn's house with Elwynn",
            "end",
            "if;not has_achievement('5')",
            "    update_achievement;5;Flashback: Saraid;Visit Elwynn's house with Saraid",
            "end",
            "if;not has_achievement('6')",
            "    update_achievement;6;Flashback: Elspeth and Elwynn;Visit Elspeth's house with Elwynn",
            "end",
            "if;not has_achievement('7')",
            "    update_achievement;7;Flashback: Elspeth and Quinley;Visit Elspeth's house with Quinley",
            "end",
            "if;not has_achievement('16')",
            "    update_achievement;16;Insurance Wouldn't Cover It!;Don't let any crates get destroyed in Ch2",
            "end",
            "if;not has_achievement('17')",
            "    update_achievement;17;It's The Right Thing To Do;Don't let Leod die in Ch2",
            "end",
            "if;not has_achievement('18')",
            "    update_achievement;18;Meh, Never Liked Him Anyway;Let Leod die in Ch2",
            "end"
        ]
    }
]