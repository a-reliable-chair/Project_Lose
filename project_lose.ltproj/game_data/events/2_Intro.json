[
    {
        "name": "Intro",
        "trigger": "level_start",
        "level_nid": "2",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "give_item;Emberson;AngelFeather;no_banner;droppable",
            "set_stats;Soldier_18;MAG,6;immediate",
            "",
            "change_background;InsideCastle",
            "#music calm track?",
            "transition;open",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    change_team;Elwynn;player",
            "    multi_add_portrait;Elwynn;FarLeft;Elspeth;MidLeft;Garvey;MidRight;Lamonte;FarRight",
            "    speak;Elwynn;Filler!",
            "    remove_portrait;Garvey",
            "    if; {v:LeodDead} == 0",
            "        remove_portrait;Garvey",
            "        remove_portrait;Lamonte",
            "        add_portrait;Leod;MidRight",
            "        add_portrait;Quinley;FarRight",
            "        # Elwynn heals up Leod and he leaves for the church's office, telling Quinley to guard the place with the others.",
            "        speak;Leod;filler",
            "        speak;Quinley;filler",
            "        remove_portrait;Leod",
            "        remove_portrait;Quinley",
            "        add_portrait;Garvey;MidRight",
            "        add_portrait;Lamonte;FarRight",
            "    end",
            "    if; {v:LeodDead} == 1",
            "        remove_portrait;Lamonte",
            "        add_portrait;Saraid;FarRight",
            "        # If Leod is dead Saraid just adds to the convo with the group with w/e",
            "        speak;Saraid;Filler.",
            "        remove_portrait;Saraid",
            "        add_portrait;Lamonte;FarRight",
            "        # Elwynn tells the party she's the only one here and that the holy relics are safe (explains the relics, maybe?).",
            "    end",
            "    music;Pandemonium",
            "    bop_portrait;Elspeth",
            "    # The party smells smoke head to the main hall to investigate.",
            "    speak;Elspeth;Do I smell smoke?!",
            "    speak;Elwynn;The church is on fire!",
            "    transition;close",
            "    change_background",
            "    multi_remove_portrait;Elwynn;Elspeth;Garvey;Lamonte",
            "    add_weather;fire",
            "    add_weather;fire",
            "    # ENEMY PLACEMENT",
            "    add_group;Stationary;Stationary;immediate",
            "    transition;open;500",
            "    add_unit;Elwynn;0, 5;fade;stack;west",
            "    add_unit;Elspeth;0, 6;fade;stack;west",
            "    add_unit;Garvey;0, 6;fade;stack;west",
            "    add_unit;Lamonte;0, 7;fade;stack;west",
            "    add_unit;Orla;0, 7;fade;stack;west",
            "    add_unit;Ailsa;0, 8;fade;stack;west",
            "    if;{v:LeodDead} == 0",
            "        add_unit;Quinley;0, 5;fade;stack;west",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_unit;Saraid;0, 5;fade;stack;west",
            "    end",
            "    move_unit;Elwynn;1, 6;normal;no_block;no_follow",
            "    move_unit;Garvey;3, 6;normal;no_block;no_follow",
            "    move_unit;Lamonte;2, 7;normal;no_block;no_follow",
            "    move_unit;Orla;4, 7;normal;no_block;no_follow",
            "    move_unit;Ailsa;1, 8;normal;no_block;no_follow",
            "    move_unit;Elspeth;2, 9;normal;no_block;no_follow",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Quinley;3, 8;normal;no_follow",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Saraid;3, 8;normal;no_follow",
            "    end",
            "    wait;500",
            "    flicker_cursor;Elwynn",
            "    add_portrait;Elwynn;Left",
            "    # Elwynn mentions that she has keys for the church doors, but the keys for the holy relics are hidden in the library",
            "    speak;Elwynn;filler",
            "    remove_portrait;Elwynn",
            "    move_cursor;14, 4",
            "    flicker_cursor;14, 4",
            "    if;{v:LeodDead} == 0",
            "        move_cursor;Quinley",
            "        flicker_cursor;Quinley",
            "        add_portrait;Quinley;Left",
            "        # Quinley tells the party that the enemy shouldn't be able to handle the environment either so both sides are on a timer",
            "        # Survive map. Also mention looters.",
            "        speak;Quinley;filler",
            "        remove_portrait;Quinley",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_cursor;Saraid",
            "        flicker_cursor;Saraid",
            "        add_portrait;Saraid;Left",
            "        # Saraid tells the party that the enemy shouldn't be able to handle the environment either so both sides are on a timer",
            "        # Survive map. Also mention looters.",
            "        speak;Saraid;filler",
            "        remove_portrait;Saraid",
            "    end",
            "    move_cursor;0, 17;500",
            "    wait;500",
            "    move_cursor;17, 17;500",
            "    wait;500",
            "    move_cursor;17, 4;500",
            "    wait;500",
            "    move_cursor;0, 4;500",
            "    wait;500",
            "else",
            "    change_team;Elspeth;player",
            "    multi_add_portrait;Elspeth;FarLeft;Elwynn;MidLeft;Saraid;MidRight;Quinley;FarRight",
            "    speak;Elspeth;Filler!",
            "    remove_portrait;Saraid",
            "    if; {v:LeodDead} == 0",
            "        remove_portrait;Saraid",
            "        remove_portrait;Quinley",
            "        add_portrait;Leod;MidRight",
            "        add_portrait;Lamonte;FarRight",
            "        # Elspeth heals up Leod and he leaves for the church's office, telling Lamonte to guard the place with the others.",
            "        speak;Leod;filler",
            "        speak;Lamonte;filler",
            "        give_item;Elspeth;Inspire",
            "        remove_portrait;Leod",
            "        remove_portrait;Lamonte",
            "        add_portrait;Saraid;MidRight",
            "        add_portrait;Quinley;FarRight",
            "    end",
            "    if; {v:LeodDead} == 1",
            "        remove_portrait;Quinley",
            "        add_portrait;Garvey;FarRight",
            "        # If Leod is dead Garvey just adds to the convo with the group with w/e",
            "        speak;Garvey;Filler.",
            "        give_item;Elspeth;Debilitate",
            "        remove_portrait;Garvey",
            "        add_portrait;Quinley;FarRight",
            "        # Elspeth tells the party she's the only one here and that the holy relics are safe (explains the relics, maybe?).",
            "    end",
            "    music;Pandemonium",
            "    bop_portrait;Elwynn",
            "    # The party smells smoke head to the main hall to investigate.",
            "    speak;Elwynn;Do I smell smoke?!",
            "    speak;Elspeth;The church is on fire!",
            "    transition;close",
            "    change_background",
            "    multi_remove_portrait;Elspeth;Elwynn;Saraid;Quinley",
            "    add_weather;fire",
            "    add_weather;fire",
            "    # ENEMY PLACEMENT",
            "    add_group;Stationary;Stationary;immediate",
            "    transition;open;500",
            "    add_unit;Elspeth;0, 5;fade;stack;west",
            "    add_unit;Elwynn;0, 6;fade;stack;west",
            "    add_unit;Saraid;0, 6;fade;stack;west",
            "    add_unit;Quinley;0, 7;fade;stack;west",
            "    add_unit;Shayla;0, 7;fade;stack;west",
            "    add_unit;Raelin;0, 8;fade;stack;west",
            "    if;{v:LeodDead} == 0",
            "        add_unit;Lamonte;0, 5;fade;stack;west",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_unit;Garvey;0, 5;fade;stack;west",
            "    end",
            "    move_unit;Elspeth;1, 6;normal;no_block;no_follow",
            "    move_unit;Saraid;3, 6;normal;no_block;no_follow",
            "    move_unit;Quinley;2, 7;normal;no_block;no_follow",
            "    move_unit;Shayla;4, 7;normal;no_block;no_follow",
            "    move_unit;Raelin;1, 8;normal;no_block;no_follow",
            "    move_unit;Elwynn;2, 9;normal;no_block;no_follow",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Lamonte;3, 8;normal;no_follow",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Garvey;3, 8;normal;no_follow",
            "    end",
            "    wait;500",
            "    flicker_cursor;Elspeth",
            "    add_portrait;Elspeth;Left",
            "    # Elspeth mentions that she has keys for the church doors, but the keys for the holy relics are hidden in the library",
            "    speak;Elspeth;filler",
            "    remove_portrait;Elspeth",
            "    move_cursor;14, 4",
            "    flicker_cursor;14, 4",
            "    if;{v:LeodDead} == 0",
            "        move_cursor;Lamonte",
            "        flicker_cursor;Lamonte",
            "        add_portrait;Lamonte;Left",
            "        # Lamonte tells the party that the enemy shouldn't be able to handle the environment either so both sides are on a timer",
            "        # Survive map. Also mention looters.",
            "        speak;Lamonte;filler",
            "        remove_portrait;Lamonte",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_cursor;Garvey",
            "        flicker_cursor;Garvey",
            "        add_portrait;Garvey;Left",
            "        # Garvey tells the party that the enemy shouldn't be able to handle the environment either so both sides are on a timer",
            "        # Survive map. Also mention looters.",
            "        speak;Garvey;filler",
            "        remove_portrait;Garvey",
            "    end",
            "    move_cursor;0, 17;500",
            "    wait;500",
            "    move_cursor;17, 17;500",
            "    wait;500",
            "    move_cursor;17, 4;500",
            "    wait;500",
            "    move_cursor;0, 4;500",
            "    wait;500",
            "    give_skill;Elspeth;Guidance;no_banner",
            "end",
            "change_ai;Emberson;AttackInRange",
            "",
            "level_var;DeadPlayers;0",
            "level_var;GotKeys;0",
            "game_var;GotReclaimer;0",
            "game_var;EmbersonDead;0",
            "",
            "if;game.mode.nid != 'Normal'",
            "    change_objective_win;Survive 7 Turns",
            "    change_objective_simple;Survive,Turns Left {eval:8-game.turncount}",
            "    change_stats;Emberson;MAG,1,SKL,1,DEF,1,RES,1;immediate",
            "end",
            "",
            "if;'{v:EnemyReverse}' == 'Reversal'",
            "    trigger_script;Global GenericsWR",
            "elif;'{v:EnemyReverse}' == 'Double'",
            "    trigger_script;Global GenericsDR",
            "end",
            "trigger_script;Global GenericsAutoLevel",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    trigger_script;2 LunaticInventories",
            "end",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    enable_convoy;f",
            "else",
            "    enable_convoy;t",
            "end",
            "",
            "if;'{v:Jukebox}' == 'I Wanna Rock!'",
            "    change_music;player_phase;Church House Rock",
            "    change_music;enemy_phase;Church House Rock",
            "    change_music;enemy2_phase;Church House Rock",
            "    change_music;other_phase;Church House Rock",
            "elif;'{v:Jukebox}' == 'Play Some Grooves!'",
            "    change_music;player_phase;Let It Burn, I'm Groovin'",
            "    change_music;enemy_phase;Let It Burn, I'm Groovin'",
            "    change_music;enemy2_phase;Let It Burn, I'm Groovin'",
            "    change_music;other_phase;Let It Burn, I'm Groovin'",
            "else",
            "    change_music;player_phase;Sanctuary Ablaze",
            "    change_music;enemy_phase;Sanctuary Ablaze",
            "    change_music;enemy2_phase;Sanctuary Ablaze",
            "    change_music;other_phase;Sanctuary Ablaze",
            "end",
            "",
            "prep;1;Before An Impossible Battlefield;Codex,Achievements;true,true;Menu_Codex,CallAchievements"
        ]
    }
]