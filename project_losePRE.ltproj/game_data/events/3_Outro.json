[
    {
        "name": "Outro",
        "trigger": "level_end",
        "level_nid": "3",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "transition;close",
            "remove_all_units",
            "change_background;Town",
            "music;Pandemonium",
            "transition;open",
            "add_weather;sunset",
            "if;{v:DavenportRecruited} == 1",
            "    multi_add_portrait;Quinley;MidRight;Davenport;FarRight;Saraid;FarLeft;Elspeth;MidLeft",
            "    mirror_portrait;Quinley",
            "    s;Quinley;...{w} I think I have an idea.{w} Saraid, hold onto this for me, wouldja?",
            "    s;Saraid;Huh?{w} What the hell are you-?",
            "    s;Quinley;Just a little theoretical magic!{w}{clear}It's no biggie, just, ah...{w} 'kay, it's kind of a biggie, but I can-!",
            "    s;Elspeth;Quinley.{w} You intend to work your forbidden magics on this...{w} corpse!?{w}{clear}Foe or not, surely he deserves rest!",
            "    s;Quinley;Sure, sure, but he's strong, too.{w}{clear}And I think he's still got some life left in him.{w} To pay us back, yeah?{w}{clear}Besides, if we can get him to fight for us, we could save more!",
            "    s;Elspeth;This is necromancy, Quin.{w} If you embark down this path...|you'll never be able to turn back.",
            "    s;Quinley;...{w} I know.{w} Let me do this, yeah?",
            "    s;Elspeth;I don't want to.",
            "    s;Quinley;I know you don't.{w} But will you?",
            "    s;Elspeth;...",
            "    s;Quinley;Thank you.{w} Now, I just gotta...{w} this thing here...{w} twist, and...{w}{clear}There!",
            "    s;Davenport;...{w} A-ah...{w} I-I...{w} W-what...?",
            "    s;Quinley;Welcome back, big guy!{w} How're we feeling?{w} Good?{w} Awake?{w} Alive?",
            "    s;Davenport;Alive...?{w} Yes...{w} Alive.{w} I was dead, wasn't I?",
            "    s;Quinley;You sure were.{w} Your welcome, by the by.{w} So, Mister Davenport-",
            "    add_portrait;DavenportFace;Right;low_priority",
            "    expression;DavenportFace;CloseEyes",
            "    remove_portrait;Davenport;immediate",
            "    s;Davenport;Osgar.",
            "    s;Quinley;Eh?",
            "    expression;DavenportFace;NormalBlink",
            "    s;Davenport;My name.{w} It's Osgar.",
            "    bop_portrait;DavenportFace",
            "    remove_portrait;DavenportFace;immediate",
            "    add_portrait;Osgar;Right;immediate",
            "    s;Osgar;This place...{w} being here brings me back.{w} I was just a lad, then...",
            "    s;Saraid;You've been here before?",
            "    s;Osgar;Been here?{w} I lived here.{w} This is...{w} Not how I planned on returning home.",
            "    s;Quinley;Goddess, that's...{w} certainly quite the coincidence, huh?",
            "    s;Osgar;Couldn't believe my ears when I heard the news.{w} Still can't.{w}{clear}Seeing the coast...{w} made me wish I'd never left in the first place.",
            "    s;Saraid;...{w} You might be the first person here to ever regret skipping town.{w}{clear}Most of us would kill for that kind of chance.{w} What happened?",
            "    s;Osgar;The empire happened.{w} Gold exchanged hands.{w} My mother and father left.{w}{clear}In exchange, I was given a blade, and a command{semicolon}{w} \"Die for the Empire.\"{w}{clear}And...{w} I suppose, so I did.{w} Which means I've fulfilled my duty.{w}{clear}You there, girl{semicolon}{w} you gave me a second chance.{w} What's your name?",
            "    s;Quinley;Quinley, but you can call me Quin.{w} Rolls of the tongue way nicer, eh?",
            "    s;Osgar;I feel that...{w} my new duty is to you.{w} For saving my life.{w}{clear}Give the order, and I will obey.",
            "    s;Quinley;Hah!{w} I've never had anybody \"obey\" me before.{w} This is kinda exciting!{w}{clear}Uh, ahem!{w} First order of business{semicolon}{w} get us out of here alive, Osgar!{w}{clear}I don't plan on dying here, and neither do my friends.{w}{clear}They're important to me.{w} Protect them with your life, if need be.",
            "    s;Osgar;Should I have the chance to expend my life in such a manner...{w}{clear}I will not hesitate.{w} For you, Mistress Quinley, I give my life.",
            "    multi_remove_portrait;Osgar;Saraid",
            "    move_portrait;Quinley;Right",
            "    move_portrait;Elspeth;Left",
            "    s;Quinley;Didja hear that?{w} \"Mistress Quinley!\" I'm really moving up in the world!",
            "    s;Elspeth;Quin.{w} That was not only a profane act you just commited{semicolon}{w} it was-!",
            "    s;Quinley;Stupid?{w} Dangerous?{w} Irresponsible?{w} I learned from the best, big sis.{w}{clear} We both want to save lives, no matter the cost.{w} This is mine.",
            "    s;Elspeth;You cast the spell without an arcane focus!{w}{clear}Do not think me blind to the consequences! To cast like that...|you would have to expend your very essence.{w} Your life force!",
            "    s;Quinley;Yeah, yeah, I know, I know.{w} But tell me something, yeah?{w}{clear}If you could trade a few years of your life to save one of us...{w}{clear}you'd do it in a heartbeat.{w} Wouldn't you, Elspeth?",
            "    s;Elspeth;...",
            "    s;Quinley;We each have our methods, but we're on the same side.{w} Don't forget that.",
            "    remove_portrait;Quinley",
            "    s;Elspeth;Quinley...{w} I can't lose you, too...",
            "    remove_portrait;Elspeth",
            "    for;Current_Skill;[u.nid for u in u('Davenport').skills]",
            "        remove_skill;Davenport;{Current_Skill};no_banner",
            "    endf",
            "    give_skill;Davenport;Anticrit;no_banner",
            "    give_skill;Davenport;Canto;no_banner",
            "    remove_item;Davenport;WardensCleaver;no_banner",
            "    remove_item;Davenport;Silver Sword;no_banner",
            "    remove_item;Davenport;Silver Lance;no_banner",
            "    give_item;Davenport;WardensCleaver;no_banner",
            "    give_item;Davenport;Silver Lance;no_banner",
            "    give_item;Davenport;Silver Sword;no_banner",
            "    remove_tag;Davenport;Boss",
            "    change_portrait;Davenport;Osgar",
            "    set_name;Davenport;Osgar",
            "    if;not has_achievement('48')",
            "        update_achievement;48;Homecoming;Recruited Osgar in Ch4",
            "        complete_achievement;48;1;banner",
            "    end",
            "    alert;Osgar has joined the party!",
            "end",
            "",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "else",
            "    trigger_script;Global DeadUnitsRevive",
            "    multi_add_portrait;Orla;FarLeft;Corridon;MidLeft;Ailsa;MidRight;Quinley;FarRight",
            "    # The party barely made it out and that they're right near the beach/a town entrance",
            "    speak;Orla;filler",
            "    multi_remove_portrait;Orla;Ailsa;Corridon;Quinley",
            "    transition;close",
            "    change_background",
            "    music;Imperial Audacity",
            "    add_unit;Cawthorne;3, 18;immediate",
            "    # Add Davenport if alive!",
            "    move_cursor;Cawthorne",
            "    transition;open;500",
            "    wait;250",
            "    move_unit;Cawthorne;1, 23;normal",
            "    wait;500",
            "    add_portrait;Cawthorne;Right",
            "    # Ch 5 boss starts making his way to the beach. Hoping Shallcross hasn't killed the party already.",
            "    # Nearly there, Cawthorne is interrupted by Laisren who just got back in town.",
            "    speak;Cawthorne;Filler.",
            "    remove_portrait;Cawthorne",
            "    wait;250",
            "    move_cursor;0, 5",
            "    music;Hulking Step of the Empire",
            "    add_unit;Laisren;0, 5;fade;push;west",
            "    move_unit;Laisren;2, 11;normal;no_block",
            "    move_unit;Cawthorne;2, 13;normal",
            "    wait;500",
            "    multi_add_portrait;Laisren;Left;Cawthorne;Right",
            "    speak;Laisren;Filler!",
            "    speak;Cawthorne;Filler!",
            "    multi_remove_portrait;Laisren;Cawthorne",
            "    move_unit;Laisren;2, 12;normal",
            "    interact_unit;Laisren;Cawthorne;crit1,end;force_animation",
            "    # They fight and Laisren TINKS real hard, no counter attack.",
            "    wait;250",
            "    multi_add_portrait;Laisren;Left;Cawthorne;Right",
            "    # Baffled, Laisren is terrified, but Cawthorne lets him know of the party's whereabouts and lets him go join them.",
            "    speak;Laisren;Didn't even scratch him!",
            "    speak;Cawthorne;Filler!",
            "    multi_remove_portrait;Laisren;Cawthorne",
            "    move_unit;Laisren;1, 25;normal;push",
            "    wait;250",
            "    add_portrait;Laisren;Right",
            "    # Laisren looks back at the damaged town and is sad D:",
            "    speak;Laisren;filler",
            "    remove_portrait;Laisren",
            "    remove_unit;Laisren;fade;south",
            "    trigger_script;Global DeadUnitsRekill",
            "end",
            "wait;250",
            "move_cursor;Cawthorne",
            "wait;250",
            "move_unit;Cawthorne;2, 23;normal",
            "wait;250",
            "add_portrait;Cawthorne;Right",
            "# Cawthorne says that kid will make it more fun; and that it's starting to rain.",
            "speak;Cawthorne;This is gunna be fun! Rain's coming.",
            "remove_portrait;Cawthorne",
            "move_unit;Cawthorne;2, 25;normal",
            "wait;250",
            "remove_unit;Cawthorne;fade;south",
            "wait;500",
            "transition;close",
            "change_background;Plains",
            "music;Imperial Audacity",
            "transition;open",
            "multi_add_portrait;Shallcross;Left;SoldierRed;Right",
            "# Outside the town General Shallcross and her goons set up a blockade; she says she's here to witness Cawthorne and that he's in line for a promotion.",
            "s;Shallcross;...",
            "s;SoldierRed;General!{w} All our forces are  assembled, as per your orders.",
            "s;Shallcross;Good.{w} And Cawthorne?",
            "s;SoldierRed;U-uh...{w} Still missing, General.",
            "s;Shallcross;I see.{w} I came here to witness his accomplishments in person.{w}{clear}His continued absence is...{w} noted.",
            "s;SoldierRed;He's, ah...{w} known for that.{w} But he gets results!{w} The town is ours!",
            "s;Shallcross;I noticed, yes.{w} Perhaps he'll get that promotion after all...{w}{clear}But first, we must purge the last remnants of the local resistance.{w}{clear}Hold position here until Cawthorne arrives, and await further orders.",
            "s;SoldierRed;Yes, ma'am!",
            "# Soldier leaves",
            "remove_portrait;SoldierRed",
            "s;Shallcross;...{w} Hah. Storm clouds brewing overhead.{w} Looks like rain...",
            "transition;close",
            "remove_portrait;Shallcross",
            "if;not has_achievement('8')",
            "    update_achievement;8;Flashback: Alpin;Visit Alpin's house with Alpin or Laisren",
            "end",
            "if;not has_achievement('9')",
            "    update_achievement;9;Flashback: Lamonte;Visit Leod's house with Lamonte",
            "end",
            "if;not has_achievement('10')",
            "    update_achievement;10;Flashback: Garvey;Visit Leod's house with Garvey",
            "end",
            "if;not has_achievement('11')",
            "    update_achievement;11;Flashback: Corridon;Visit Corridon's house with Corridon",
            "end",
            "if;not has_achievement('21')",
            "    update_achievement;21;That's Not How You Play The Game!;Damage Cawthorne in Ch4",
            "end",
            "if;not has_achievement('22')",
            "    update_achievement;22;Every Party Needs A Pooper;Visit the tavern in Ch4",
            "end",
            "if;not has_achievement('23')",
            "    update_achievement;23;Where'd You Get That Key?!;Open the door next to Corridon's in Ch4",
            "end",
            "if;not has_achievement('24')",
            "    update_achievement;24;Mom, Can We Keep Him?;Escape with a Thrall in Ch4",
            "end"
        ]
    }
]