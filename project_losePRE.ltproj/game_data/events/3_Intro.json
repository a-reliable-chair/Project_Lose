[
    {
        "name": "Intro",
        "trigger": "level_start",
        "level_nid": "3",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "give_item;Davenport;AngelFeather;no_banner;droppable",
            "set_stats;Soldier_5;STR,5;immediate",
            "set_stats;Soldier_5;SKL,7;immediate",
            "set_stats;Soldier_12;MAG,6;immediate",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    remove_region;ShaylaMom",
            "    add_unit;Laisren;16, 3;immediate",
            "    add_unit;Elwynn;16, 1;immediate",
            "    add_unit;Lamonte;17, 2;immediate",
            "    move_unit;Garvey;18, 1;immediate",
            "    if;{v:LeodDead} == 0",
            "        add_unit;Quinley;20, 3;immediate",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_unit;Saraid;20, 3;immediate",
            "    end",
            "    change_team;Shayla;player",
            "    change_team;Raelin;player",
            "    change_team;Carlin;player",
            "    add_unit;Shayla;17, 4;immediate",
            "    add_unit;Garvey;18, 3;immediate",
            "    add_unit;Carlin;19, 2;immediate",
            "else",
            "    change_background;Town",
            "    music;Pandemonium",
            "    transition;open",
            "    trigger_script;Global DeadUnitsRevive",
            "    multi_add_portrait;Elspeth;FarLeft;Elwynn;MidLeft;Quinley;MidRight;Saraid;FarRight",
            "    # The party get to the market/pier in the early hours of the morning.",
            "    # Alpin and Lamonte/Garvey point out visitable houses.",
            "    s;Elspeth;The sun looks to be rising soon.{w} Has it truly been a full night already?",
            "    s;Elwynn;Gonna be a hell of a lot harder for us to skulk around in the daylight...|Things could get ugly, fast.",
            "    s;Saraid;As if they weren't already ugly...",
            "    s;Quinley;Well as long as we're quick, we should be able to get to safety soon, right?",
            "    remove_portrait;Quinley",
            "    add_portrait;Alpin;MidRight",
            "    s;Alpin;No!{w} I-I mean...{w} we can't just leave.{w}{clear}M-my folks...{w} I need to check on my ma and pa.{w} I need to know if...{w} if...",
            "    s;Elwynn;...{w} Damn it, kid.{w} We'll find your folks, I promise.{w} Just...{w} stay alive.",
            "    s;Alpin;Mhm.{w} I've done an okay job of it so far, right?{w} I can do it a bit longer.",
            "    s;Elspeth;Let's just hope you're right...",
            "    remove_portrait;Saraid",
            "    if;{v:LeodDead} == 0",
            "        add_portrait;Lamonte;FarRight",
            "        s;Lamonte;...{w} Leod's house is around here.{w} The man was cruel and bullheaded, but...{w} I'd still like to pay my respects.{w}{clear}After all, this may be my last chance at some sentimentality.",
            "        remove_portrait;Lamonte",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_portrait;Garvey;FarRight",
            "        s;Garvey;Hey, you know, Leod's place isn't too far from here.{w} We should check it out.{w}{clear}The fat lard took something of mine.{w} \"Too inhumane!\" he said, \"too cruel!\"{w}{clear}But I say now's exactly the time for some pragmatism, don't you all agree?",
            "        remove_portrait;Garvey",
            "    end",
            "    s;Elspeth;We'll consider it.{w} For now, let's not waste any more precious nighttime.",
            "    remove_portrait;Alpin",
            "    move_portrait;Elwynn;Right",
            "    mirror_portrait;Elwynn",
            "    move_portrait;Elspeth;Left",
            "    # Elspeth sees action on the pier. Ailsa, Orla, and Corridon are dispatching some mooks.",
            "    s;Elwynn;Psst, Elspeth.{w} Over there.{w} Fighting.",
            "    s;Elspeth;By the pier?{w} Then, we're not the only survivors!?{w} Q-quickly, come!|We have to help them!{w} With me!",
            "    s;Elwynn;W-wait, Elspeth!",
            "    multi_remove_portrait;Elspeth;Elwynn",
            "    transition;close",
            "    add_unit;Ailsa;19,4;immediate",
            "    add_unit;Orla;18,4;immediate",
            "    add_unit;Corridon;18,3;immediate",
            "    music;Hulking Step of the Empire",
            "    move_cursor;21, 0",
            "    change_background",
            "    move_cursor;Ailsa",
            "    transition;open",
            "    wait;250",
            "    multi_add_portrait;Orla;Left;Corridon;MidRight;Ailsa;FarRight",
            "    mirror_portrait;Orla;no_block",
            "    s;Orla;Hyah!{w} Hahaha!{w} Watch 'em scatter, Cor!",
            "    s;Corridon;Careful, Orla, behind you!",
            "    s;Ailsa;I got it!",
            "    multi_remove_portrait;Orla;Ailsa;Corridon",
            "    move_unit;Cutscene_1;19, 5;normal;no_follow",
            "    interact_unit;Cutscene_1;Ailsa;miss1,end;force_no_animation",
            "    interact_unit;Ailsa;Cutscene_1;crit1,end;Junk;force_no_animation",
            "    wait;250",
            "    multi_add_portrait;Orla;Left;Corridon;MidRight;Ailsa;FarRight",
            "    # fighting!",
            "    s;Ailsa;Phew!{w} Cutting it a little close there, eh, Orla?",
            "    s;Orla;Maybe, maybe -{w} but we won!",
            "    s;Corridon;Not yet we haven't.{w} Look, there{semicolon}{w} even more of the bastards.",
            "    multi_remove_portrait;Orla;Ailsa;Corridon",
            "    add_unit;Alpin;16, 0;fade;stack;north",
            "    add_unit;Elspeth;17, 0;fade;push;north",
            "    add_unit;Saraid;16, 0;fade;stack;north",
            "    add_unit;Quinley;17, 0;fade;push;north",
            "    if;{v:LeodDead} == 0",
            "        add_unit;Lamonte;20, 0;fade;push;north",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_unit;Garvey;20, 0;fade;push;north",
            "    end",
            "    wait;250",
            "    move_unit;Alpin;16, 3;normal;no_block;no_follow",
            "    move_unit;Elspeth;16, 1;normal;no_block;no_follow",
            "    move_unit;Quinley;17, 2;normal;no_block;no_follow",
            "    move_unit;Saraid;18, 1;normal;no_block;no_follow",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Lamonte;20, 3;normal;no_follow",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Garvey;20, 3;normal;no_follow",
            "    end",
            "    wait;250",
            "    change_team;Orla;player",
            "    change_team;Ailsa;player",
            "    change_team;Corridon;player",
            "    multi_add_portrait;Orla;FarLeft;Ailsa;MidLeft;Corridon;MidRight;Elspeth;FarRight",
            "    # Orla, Ailsa, and Corridon join the party. The group comes to terms with the fact that the town may be a lost cause at this point and they need to get out of here.",
            "    # elspeth crew rocks up",
            "    s;Elspeth;My word, you're all still alive!{w}{clear}I thought for sure we were the last ones left, but I'm glad to be wrong.",
            "    s;Ailsa;It'll keep more than this rabble to put us down, El!",
            "    s;Corridon;Mm.{w} It's good to see you, regardless.{w}{clear}We need help, and if you're here, then so do you.",
            "    s;Ailsa;There's just so many...{w} But we have to fight them off!",
            "    remove_portrait;Corridon",
            "    add_portrait;Elwynn;MidRight",
            "    s;Elwynn;No, we...{w} we don't.{w} We can't.",
            "    s;Orla;Eh?{w} What, you're just gonna abandon the town?{w} Can't say I'm surprised.{w}{clear}It'd be just like you to ditch your sisters at a time like this...",
            "    s;Elspeth;Orla...{w} Elwynn has the right of it.{w}{clear}If we stay here and fight,{w} we'll be overwhelmed eventually.{w} And then...{w} Well...{w}{clear}I can't let these people die just to appease my sense of honour.",
            "    s;Elwynn;Save who we can, and bury the rest.{w}{clear}It's not pretty, but it's the best we can do at this point.",
            "    s;Ailsa;You...{w} really think it's that bad?{w}{clear}Surely, there are other survivors like us,{w} a-and if we can find them-!",
            "    remove_portrait;Elwynn",
            "    add_portrait;Corridon;MidRight",
            "    s;Corridon;-then they'll be in just as bad a way as us,{w} if not even worse.{w}{clear}Bah.{w} I didn't want to admit it,{w} but it's been obvious all night long.{w}{clear}All this fighting of ours...{w} it's just killing time until the end.",
            "    s;Orla;...{w} We could stand a chance if you stood your ground and fought with me.",
            "    s;Elspeth;And we'd stand a far greater chance to escape if you came with us.{w}{clear}Please, Orla...{w} I know how you feel.{w} Help me save what lives I still can.{w}{clear}I-I can't...{w} This is all I can do.",
            "    s;Orla;But we can't just...{w} I mean, we have to...{w} Can we really...?{w}{clear}{c:bop_portrait;Orla}Damn it all, fine! I'm not gonna leave you high and dry like that.{w}{clear}Even if I don't like the plan...{w} I can still help make sure it works.",
            "    s;Elspeth;Thank you.{w} All of you, th-thank you.",
            "    remove_portrait;Corridon",
            "    add_portrait;Elwynn;MidRight",
            "    s;Elwynn;...{w} Ahem.{w} W-we should get moving.{w}{clear}They'll be swarming all over soon{semicolon}{w} we'll have to fight our way out.",
            "    s;Elspeth;Right.{w} Let's...{w} get moving again.",
            "    remove_portrait;Elspeth",
            "    move_portrait;Elwynn;Right",
            "    s;Ailsa;...{w} She's hurting.{w} Badly.",
            "    s;Elwynn;We all are.{w} Just...{w} I'd hoped she would be stronger than us rabble.{w}{clear}Selfish, maybe, but...{w} I couldn't handle all the pressure alone.{w}{clear}And...{w} I guess neither can she.",
            "    s;Ailsa;Well, she's got you.{w} That's worth something, at least, right?",
            "    s;Elwynn;Not as much as it should be...{w} but aye, I won't let her down again.{w}{clear}I've had a lifetime of disappointing her.|No more.{w} That ends, tonight...{w}{clear}Whether I survive it or not.",
            "    multi_remove_portrait;Orla;Ailsa;Elwynn",
            "    move_unit;Orla;17, 4;normal;no_block;no_follow",
            "    move_unit;Saraid;18, 3;normal;push;no_block;no_follow",
            "    move_unit;Corridon;19, 2;normal",
            "    wait;250",
            "    if;{v:RaelinBoss} >= 2 and game.check_alive('Raelin')",
            "        flicker_cursor;Raelin",
            "        flicker_cursor;Ailsa",
            "        multi_add_portrait;Raelin;Left;Ailsa;Right",
            "        music;Betimed Blossoming",
            "        s;Raelin;Auntie!{w} Oh my gosh, you're okay!",
            "        s;Ailsa;Aye, kid, I'm alright.{w} And I see you've been doing fine, yourself.",
            "        s;Raelin;F-fine?{w} No...{w} no, it was terrible!{w} We nearly died so many times, a-and|I had to...{w} I had to...{w} k-kill...",
            "        s;Ailsa;...{w} You deserve better than this.{w}{clear}But it's good that you learned your lessons.{w} If not for our training...",
            "        s;Raelin;I know.{w} That's the worst part.{w}{clear}It would've been so easy for some tiny mistake to just...{w} end it.|A-and I...{w} I've been so scared.{w} I wish I was brave like you, Auntie!",
            "        s;Ailsa;Kid, you think I'm not scared too?",
            "        s;Raelin;You...{w} you are?",
            "        s;Ailsa;'Course I am.{w} Scared of dying, of all the killing...{w} of losing you.|Turns out I had nothing to fear!{w}{clear}I mean, just look at you{semicolon}{w} you're a veritable warrior, aren't you?",
            "        s;Raelin;M-me?{w} I don't know...{w} I don't want to be a warrior, but...{w} I guess so.",
            "        s;Ailsa;...{w} Tch.",
            "        s;Raelin;S-sorry, did I say something wrong?",
            "        s;Ailsa;No, no, it's me I'm pissed at.{w}{clear}You're right to not want that life. It'll keep you happier.{w} Healthier.|...{w} Safer.",
            "        s;Raelin;Auntie Ailsa, you're...{w} shaking?",
            "        s;Ailsa;Tell you what.{w}{clear}You're just a kid{semicolon} they'll never expect you to be a threat.|Use that to your advantage.{w}{clear}I wish I could tell you to just...{w} stay behind me, keep yourself safe.{w} But something tells me you'll have to keep on fighting until the end.{w}{clear}So let them think you're a scared little girl.{w}{clear}They'll ignore you.|Then...{w} Do what you gotta do.",
            "        s;Raelin;Right...{w} I promise I'll stay alive for you, Auntie.{w}{clear}But you have to promise me right back, okay?",
            "        s;Ailsa;Hah!{w} Alright, kid.{w} Promise.",
            "        multi_remove_portrait;Raelin;Ailsa",
            "        give_skill;Raelin;Shade",
            "        inc_game_var;RaelinUpgraded;1",
            "    end",
            "    if;{v:ShaylaVisited} == 0",
            "        remove_region;ShaylaMom",
            "    end",
            "    trigger_script;Global DeadUnitsRekill",
            "end",
            "move_cursor;16, 8",
            "flicker_cursor;16, 8",
            "transition;close",
            "music;Imperial Audacity",
            "change_background;House",
            "transition;open",
            "add_portrait;Cawthorne;Right",
            "# The Ch 5 boss who went to the tavern had a fun night of slaughtering the tavern goers and drinking but thinks it's soon time to go check on his army.",
            "# He's going to spawn a few turns in as a super boss from the tavern (like the black knight in that PoR chapter)",
            "s;Cawthorne;Hah!{w} Aye, that's enough drinking.{w}{clear}I expected swill, but I suppose a backwater like this needs good ale.{w}{clear}'Bout time I get back to business.{w}{clear}Wonder if this town's got any more fight left in it after tonight...{w}{clear}These yokels die easy enough, but they're no sporting fun.{w}{clear}Ah, a man can only dream, eh?{w} Ahaha!",
            "remove_portrait;Cawthorne",
            "transition;close",
            "change_background",
            "move_cursor;21, 0",
            "transition;open",
            "change_ai;Davenport;Ch4_AttackInRange",
            "level_var;DeadPlayers;0",
            "level_var;BossMusic;0",
            "game_var;DavenportDead;0",
            "game_var;DavenportRecruited;0",
            "",
            "if;game.mode.nid != 'Normal'",
            "    change_stats;Davenport;STR,1,SKL,1,DEF,1,RES,1;immediate",
            "    change_stats;Cawthorne;STR,1,SKL,1,DEF,1;immediate",
            "end",
            "",
            "if;'{v:EnemyReverse}' == 'Reversal'",
            "    trigger_script;Global GenericsWR",
            "elif;'{v:EnemyReverse}' == 'Double'",
            "    trigger_script;Global GenericsDR",
            "end",
            "trigger_script;Global GenericsAutoLevel",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    trigger_script;3 LunaticInventories",
            "end",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    enable_convoy;f",
            "else",
            "    enable_convoy;t",
            "end",
            "",
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    show_layer;LeftRR;immediate",
            "    show_layer;BotRR;immediate",
            "end",
            "",
            "",
            "if;'{v:Jukebox}' == 'I Wanna Rock!'",
            "    change_music;player_phase;Little Bitta Hype",
            "    change_music;enemy_phase;Little Bitta Hype",
            "    change_music;enemy2_phase;Little Bitta Hype",
            "    change_music;other_phase;Little Bitta Hype",
            "    prep;1;Prep Jam;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "elif;'{v:Jukebox}' == 'Play Some Grooves!'",
            "    change_music;player_phase;Jammin'",
            "    change_music;enemy_phase;Jammin'",
            "    change_music;enemy2_phase;Jammin'",
            "    change_music;other_phase;Jammin'",
            "    prep;1;TPWD;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "else",
            "    change_music;player_phase;Periphery Of Mayhem",
            "    change_music;enemy_phase;Periphery Of Mayhem",
            "    change_music;enemy2_phase;Periphery Of Mayhem",
            "    change_music;other_phase;Periphery Of Mayhem",
            "    prep;1;Before An Impossible Battlefield;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "end"
        ]
    }
]