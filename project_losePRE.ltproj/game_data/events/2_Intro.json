[
    {
        "name": "Intro",
        "trigger": "level_start",
        "level_nid": "2",
        "condition": "True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "if;'{v:ReverseRecruitment}' == 'Yes'",
            "    add_weather;fire",
            "    add_weather;smoke",
            "    # ENEMY PLACEMENT",
            "    add_group;Stationary;Stationary;immediate",
            "    add_unit;Elwynn;1, 6;immediate",
            "    add_unit;Garvey;3, 6;immediate",
            "    add_unit;Lamonte;2, 7;immediate",
            "    add_unit;Orla;4, 7;immediate",
            "    add_unit;Ailsa;1, 8;immediate",
            "    add_unit;Elspeth;2, 9;immediate",
            "    if;{v:LeodDead} == 0",
            "        add_unit;Quinley;3, 8;immediate",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_unit;Saraid;3, 8;immediate",
            "    end",
            "else",
            "    change_background;InsideCastle",
            "    music;Sanctuary",
            "    level_var;RaelinEmberson;0",
            "    trigger_script;Global DeadUnitsRevive",
            "    change_team;Elspeth;player",
            "    transition;open",
            "    add_portrait;Elspeth;OffscreenLeft",
            "    move_portrait;Elspeth;Left",
            "    speak;Elspeth;Everyone!",
            "    move_portrait;Elspeth;Right",
            "    mirror_portrait;Elspeth",
            "    speak;Elspeth;Through here!",
            "    move_portrait;Elspeth;MidRight",
            "    if; {v:LeodDead} == 0",
            "        multi_add_portrait;Elwynn;FarRight;Leod;MidLeft;Lamonte;FarLeft",
            "        # Elspeth heals up Leod and he leaves for the church's office, telling Lamonte to guard the place with the others.",
            "        #//Elspeth heals up Leod and he leaves for the church's office, telling Lamonte to guard the place with the others.",
            "        s;Elspeth;Alright, we should be safe here for now.{w}{clear}Leod, lie down there, let me heal your wounds.",
            "        remove_portrait;Leod",
            "        s;Leod;Ah...{w} Lady Elspeth...{w} You are truly as the goddess reborn!{w}{clear}Your gifts are-{w} OUCH!",
            "        s;Elspeth;Sorry, but we've no time for your idle flattery...{w} or for more soothing magicks.{w}{clear}Your wounds will hold, and the pain will fade.",
            "        add_portrait;Leod;MidLeft",
            "        s;Leod;I thought you were known for your gentle touch...",
            "        s;Elspeth;Yes, well,{w} that was during happier times,{w} when I was afforded such luxury.",
            "        s;Lamonte;We're lucky your injuries are mostly superficial.|It could've been a lot worse...",
            "        s;Leod;Y-yes, well, when you put it like that...{w}{clear}I suppose I'm grateful,{w} Lady Elspeth.{w}{clear}Please, accept this as payment for your services.",
            "        give_item;Elspeth;AngelFeather",
            "        s;Elwynn;So, now what?{w} What's our next move?",
            "        s;Elspeth;\"Next move\"?{w}{clear}We fortify this church,{w} keep the kids safe,{w} and wait for the army to arrive.",
            "        s;Lamonte;Then we'll be waiting a long time.|You sure we can hold out that long?",
            "        s;Elwynn;Even then, that's assuming they send anybody after us.{w}{clear}Backwater nowhere like this, could be they just leave us to die...",
            "        s;Leod;Preposterous!{w}{clear}{c:bop_portrait;Leod}His Majesty would never leave a subject as loyal as myself to die!",
            "        s;Elspeth;I've little faith in our other options,{w} and my duty is to protect the-",
            "        move_portrait;Leod;OffscreenRight",
            "        bop_portrait;Elwynn",
            "        s;Elwynn;Leod?{w}{c:mirror_portrait;Elwynn} Where are you going?",
            "        s;Leod;To the annals, of course!{w} There are important documents I must secure.{w}{clear}Lamonte, stay here and guard the place, would you?",
            "        move_portrait;Lamonte;Left",
            "        s;Lamonte;Aye, sir, but is now the best time to-?",
            "        s;Leod;Yes, yes, I trust you'll have a plan ready for me by the time I return, hmm?",
            "        remove_portrait;Leod",
            "        #//Leod heads downstairs",
            "        mirror_portrait;Elwynn",
            "        s;Elspeth;Ahem.{w} As I was saying, we have to protect the relics.|It wouldn't be right to abandon them.",
            "        s;Elwynn;Aye, but surely we've got a better shot than this, right?{w}{clear}Like getting the hells out of this dump, for starters...",
            "        s;Elspeth;\"This dump\" is our home, Elwynn!{w} Surely, you haven't already forgotten?{w}{clear}Besides, the relics aren't just trinkets!{w} They hold power -{w} real power!{w} - that we could use to defend ourselves.",
            "        s;Lamonte;My lady,{w} I procured this staff after we were separated from Leod.{w}{clear}I trust it'd be of more use in your hands than mine?",
            "        give_item;Elspeth;Inspire",
            "        remove_portrait;Lamonte",
            "    end",
            "    if; {v:LeodDead} == 1",
            "        multi_add_portrait;Elwynn;FarRight;Garvey;Left",
            "        # If Leod is dead Garvey just adds to the convo with the group with w/e",
            "        s;Elspeth;Alright, we should be safe here for now.{w}{clear}A shame we've already lost so many...",
            "        s;Garvey;...{w} Lamonte was a better man than most, ass though he was.{w}{clear}Town's better off without that prick of a mayor, though.",
            "        bop_portrait;Elspeth",
            "        s;Elspeth;Better off?{w} Look around, Garvey.|Could be we're all that's left of this place.",
            "        s;Garvey;Aye, and we're better off without him.",
            "        s;Elspeth;There are no deaths worth celebrating, Garvey.|You'd do well to learn that.",
            "        s;Garvey;*grumble grumble*",
            "        s;Elwynn;So, now what?|What's our next move?",
            "        s;Elspeth;\"Next move\"?{w}{clear}We fortify this church,{w} keep the kids safe,{w} and wait for the army to arrive.",
            "        s;Garvey;Pssht, really, lady?{w}{clear}You couldn't even classify this lot as a militia,{w} and you think we can survive that long?",
            "        s;Elwynn;Even then, that's assuming they send anybody after us.{w}{clear}Backwater nowhere like this, could be they just leave us to die...",
            "        s;Elspeth;I've little faith in our other options,{w} and my duty is to protect the relics.|It wouldn't be right to abandon them.",
            "        s;Elwynn;Aye, but surely we've got a better shot than this, right?{w}{clear}Like getting the hells out of this dump, for starters...",
            "        s;Elspeth;\"This dump\" is our home, Elwynn!{w} Surely, you haven't already forgotten?{w}{clear}Besides, the relics aren't just trinkets!{w} They hold power -{w} real power!{w} - that we could use to defend ourselves.",
            "        s;Garvey;Ugh, you people are insufferable.{w}{clear}Take this junk, I got it off of one of the invaders{semicolon}{w} You pious lot couldn't hold a real weapon anyway.",
            "        give_item;Elspeth;Debilitate",
            "        remove_portrait;Garvey",
            "        # Elspeth tells the party she's the only one here and that the holy relics are safe (explains the relics, maybe?).",
            "    end",
            "    music_clear",
            "    wait;250",
            "    sound;Wall Attack",
            "    wait;250",
            "    multi_add_portrait;Alpin;MidLeft;Saraid;FarLeft",
            "    #//A rumble is heard",
            "    bop_portrait;Elspeth",
            "    s;Elspeth;Wh-what was that?",
            "    s;Elwynn;Nothing good, I'll bet you.|Any idea where that came from?",
            "    s;Alpin;Sounded almost like an explosion...",
            "    s;Saraid;Hey, hold up a sec.|Anybody else smell that?",
            "    wait;500",
            "    music;Pandemonium",
            "    #//A pause",
            "    s;Alpin;It smells almost like...",
            "    s;Elspeth;...{w} smoke.|By the Goddess, don't tell me-",
            "    #//Shayla runs in",
            "    remove_portrait;Saraid",
            "    add_portrait;Shayla;OffscreenLeft",
            "    move_portrait;Shayla;FarLeft",
            "    s;Shayla;Fire!{w}{c:bop_portrait;Shayla} There's a f-fire!|{c:bop_portrait;Shayla}A-a-and more troops!!",
            "    s;Elspeth;Inside!?{w} But how!?",
            "    s;Elwynn;They must have blown a hole in the damn building.{w}{clear}Any bright ideas now!?",
            "    s;Elspeth;I-I...{w} We...{w} have to escape.{w} We have to run!{w} But the relics-",
            "    s;Elwynn;We'll worry about the relics when we get there,{w} Elspeth, now come on!!",
            "    transition;close",
            "    change_background",
            "    multi_remove_portrait;Elspeth;Elwynn;Shayla;Alpin",
            "    add_weather;fire",
            "    add_weather;smoke",
            "    # ENEMY PLACEMENT",
            "    add_group;Stationary;Stationary;immediate",
            "    transition;open;500",
            "    add_unit;Elspeth;0, 5;fade;stack;west",
            "    add_unit;Elwynn;0, 6;fade;stack;west",
            "    add_unit;Saraid;0, 6;fade;stack;west",
            "    add_unit;Quinley;0, 7;fade;stack;west",
            "    add_unit;Shayla;0, 7;fade;stack;west",
            "    add_unit;Raelin;0, 8;fade;stack;west",
            "    if;{v:LeodDead} == 0",
            "        add_unit;Lamonte;0, 5;fade;stack;west",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_unit;Garvey;0, 5;fade;stack;west",
            "    end",
            "    move_unit;Elspeth;1, 6;normal;no_block;no_follow",
            "    move_unit;Saraid;3, 6;normal;no_block;no_follow",
            "    move_unit;Quinley;2, 7;normal;no_block;no_follow",
            "    move_unit;Shayla;4, 7;normal;no_block;no_follow",
            "    move_unit;Raelin;1, 8;normal;no_block;no_follow",
            "    move_unit;Elwynn;2, 9;normal;no_block;no_follow",
            "    if;{v:LeodDead} == 0",
            "        move_unit;Lamonte;3, 8;normal;no_follow",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        move_unit;Garvey;3, 8;normal;no_follow",
            "    end",
            "    wait;500",
            "    multi_add_portrait;Elspeth;MidRight;Alpin;FarLeft;Elwynn;MidLeft",
            "    if;{v:LeodDead} == 0",
            "        add_portrait;Lamonte;FarRight",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        add_portrait;Garvey;FarRight",
            "    end",
            "    # Elspeth mentions that she has keys for the church doors, but the keys for the holy relics are hidden in the library",
            "    s;Elspeth;I have the keys to open the doors around here,{w} but the reliquary keys are still in the library!{w}{clear}If we want to save the relics, we have to head there first!",
            "    s;Elwynn;If we can get our hands on the spear, at least...{w} then, maybe we'll stand a fighting chance.",
            "    s;Alpin;None of that'll matter if we can't get out of here!{w}{clear}They're gonna cook us alive...",
            "    s;Elwynn;Us and them, both.{w}{clear}Looks like we're *both* racing the hourglass on this one.{w} But why are they bothering?",
            "    if;{v:LeodDead} == 0",
            "        speak;Lamonte;The fiends are probably trying to rob the place while there's still time.{w}{clear}Time is not on any of our sides here,{w} but maybe we can stop those looters!{w}{clear}After all, without those artifacts, we're...",
            "        remove_portrait;Lamonte",
            "    end",
            "    if;{v:LeodDead} == 1",
            "        speak;Garvey;Isn't it obvious?{w} They're as desperate for the church's artifacts as we are.{w}{clear}We're both racing against time on this one,{w} but I say we try to win it.{w}{clear}Stop their looters, and the artifacts are ours.",
            "        remove_portrait;Garvey",
            "    end",
            "    remove_portrait;Alpin",
            "    move_portrait;Elspeth;Right",
            "    move_portrait;Elwynn;Left",
            "    s;Elspeth;Then...{w} we have our plan, for now.|The rest, we'll play by ear.",
            "    s;Elwynn;...{w} I was hoping you'd know better than me about what to do.",
            "    s;Elspeth;We're all just guessing, Elwynn.|I-I'm sorry I can't do better...{w}{clear}You did well to keep the kids safe this long.",
            "    s;Elwynn;Mm, well...{w} They aren't safe yet.{w}{clear}Let's save the congratulations for once we get out of town.",
            "    s;Elspeth;If you wish.{w} But...{w}{clear}I'm proud of you.{w} That's all.",
            "    s;Elwynn;...",
            "    multi_remove_portrait;Elwynn;Elspeth",
            "    move_cursor;0, 17;500",
            "    wait;500",
            "    move_cursor;17, 17;500",
            "    wait;500",
            "    move_cursor;17, 4;500",
            "    wait;500",
            "    move_cursor;0, 4;500",
            "    wait;500",
            "    give_skill;Elspeth;Guidance;no_banner",
            "    trigger_script;Global DeadUnitsRekill",
            "end",
            "change_ai;Emberson;AttackInRange",
            "",
            "level_var;DeadPlayers;0",
            "level_var;GotKeys;0",
            "level_var;EmbersonQuote;0",
            "level_var;BossMusic;0",
            "game_var;GotReclaimer;0",
            "game_var;EmbersonDead;0",
            "",
            "if;game.mode.nid != 'Normal'",
            "    change_objective_win;Survive 7 Turns",
            "    change_objective_simple;Survive,Turns Left {eval:8-game.turncount}",
            "    change_stats;Emberson;MAG,1,SKL,1,DEF,1,RES,1;immediate",
            "end",
            "",
            "if;'{v:EnemyReverse}' == 'Reversal'",
            "    trigger_script;Global GenericsWR",
            "elif;'{v:EnemyReverse}' == 'Double'",
            "    trigger_script;Global GenericsDR",
            "end",
            "trigger_script;Global GenericsAutoLevel",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    trigger_script;2 LunaticInventories",
            "end",
            "",
            "if;game.mode.nid == 'Lunatic'",
            "    enable_convoy;f",
            "else",
            "    enable_convoy;t",
            "end",
            "",
            "",
            "if;'{v:Jukebox}' == 'I Wanna Rock!'",
            "    change_music;player_phase;Church House Rock",
            "    change_music;enemy_phase;Church House Rock",
            "    change_music;enemy2_phase;Church House Rock",
            "    change_music;other_phase;Church House Rock",
            "    prep;1;Prep Jam;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "elif;'{v:Jukebox}' == 'Play Some Grooves!'",
            "    change_music;player_phase;Let It Burn, I'm Groovin'",
            "    change_music;enemy_phase;Let It Burn, I'm Groovin'",
            "    change_music;enemy2_phase;Let It Burn, I'm Groovin'",
            "    change_music;other_phase;Let It Burn, I'm Groovin'",
            "    prep;1;TPWD;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "else",
            "    change_music;player_phase;Sanctuary Ablaze",
            "    change_music;enemy_phase;Sanctuary Ablaze",
            "    change_music;enemy2_phase;Sanctuary Ablaze",
            "    change_music;other_phase;Sanctuary Ablaze",
            "    prep;1;Before An Impossible Battlefield;Codex,Achievements;true,true;Menu_Codex,CallAchievements",
            "end"
        ]
    }
]